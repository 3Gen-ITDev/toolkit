/*!
 * Titon Toolkit v1.2.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Flyout=Toolkit.Component.extend(function(b,c,d){if(!c)throw new Error("Flyout URL required to download sitemap JSON");this.component="Flyout",this.version="1.2.0",this.options=d=this.setOptions(d),this.nodes=b=a(b),this.node=null,this.element=null,this.current=null,this.menus={},this.data=[],this.dataMap={},this.timers={},this.events={},a.getJSON(c,this.load.bind(this)),"click"===d.mode?this.events["click "+b.selector]="onShow":(this.events["mouseenter "+b.selector]=["onShow","onEnter"],this.events["mouseleave "+b.selector]="onLeave"),this.enable(),this.fireEvent("init")},{clearTimer:function(a){clearTimeout(this.timers[a]),delete this.timers[a]},hide:function(){this.node.removeClass(Toolkit.options.isPrefix+"active"),this.current&&this.isVisible()&&(this.menus[this.current].conceal(),this.fireEvent("hide"),this.current=null)},isVisible:function(){return this.current&&this.menus[this.current]&&(this.element=this.menus[this.current]),this.element&&this.element.is(":shown")},load:function(a,b){if(b=b||0,0===b&&(this.data=a),a.url&&(this.dataMap[a.url]=a),a.children)for(var c=0,d=a.children.length;d>c;c++)this.load(a.children[c],b+1)},position:function(){var b=this.current,c=this.options;if(this.menus[b]){var d=this.menus[b],e=d.outerHeight(),f=this.node.offset(),g=f.left+c.xOffset,h=f.top+c.yOffset+this.node.outerHeight(),i=a(window).height();h>i/2&&(h=f.top-c.yOffset-e),d.css({left:g,top:h}).reveal(),this.fireEvent("show")}},show:function(b){var c=this._getTarget(b);this.current&&c!==this.current&&(this.hide(),this.startTimer("show",this.options.showDelay)),this.node=a(b),this._getMenu()&&(this.node.addClass(Toolkit.options.isPrefix+"active"),"click"===this.options.mode&&this.position())},startTimer:function(a,b,c){this.clearTimer(a);var d;d="show"===a?this.position.bind(this):this.hide.bind(this),d&&(this.timers[a]=setTimeout(function(){d.apply(this,c||[])}.bind(this),b))},_buildMenu:function(b,c){if(!c.children||!c.children.length)return null;var d,e,f,g,h,i=a(this.options.template),j=[],k=this.options.contentElement,l=this.options.itemLimit;if(this.options.className&&i.addClass(this.options.className),b.is("body")&&i.addClass(Toolkit.options.isPrefix+"root"),l&&c.children.length>l)for(g=0,h=c.children.length;h>g;)j.push(c.children.slice(g,g+=l));else j.push(c.children);for(var m,n,o=0;m=j[o];o++){for(d=a("<ul/>"),g=0,h=m.length;h>g;g++)n=m[g],e=a("<li/>"),n.url?(f=a("<a/>",{text:n.title,href:n.url}),a("<span/>").addClass(n.icon||"caret-right").prependTo(f)):(f=a("<span/>",{text:n.title}),e.addClass(Toolkit.options.vendor+"flyout-heading")),n.attributes&&f.attr(n.attributes),n.className&&e.addClass(n.className),e.append(f).appendTo(d),n.children&&n.children.length&&(this._buildMenu(e,n),e.addClass(Toolkit.options.hasPrefix+"children").on("mouseenter",this.onPositionChild.bind(this,e)).on("mouseleave",this.onHideChild.bind(this,e)));k?i.is(k)?i.append(d):i.find(k).append(d):i.append(d)}return i.appendTo(b),i},_getMenu:function(){var b=this._getTarget();if(this.menus[b])return this.current=b,this.menus[b];if(this.dataMap[b]){var c=this._buildMenu(a("body"),this.dataMap[b]);return c?(c.conceal(),"click"!==this.options.mode&&c.on({mouseenter:function(){this.clearTimer("hide")}.bind(this),mouseleave:function(){this.startTimer("hide",this.options.hideDelay)}.bind(this)}),this.current=b,this.menus[b]=c,this.menus[b]):null}return null},_getTarget:function(b){return b=a(b||this.node),this.readValue(b,this.options.getUrl)||b.attr("href")},onEnter:function(){this.clearTimer("hide"),this.startTimer("show",this.options.showDelay)},onHideChild:function(b){b=a(b),b.removeClass(Toolkit.options.isPrefix+"open"),b.children(this.options.contentElement).removeAttr("style"),this.fireEvent("hideChild",b)},onLeave:function(){this.clearTimer("show"),this.startTimer("hide",this.options.showDelay)},onPositionChild:function(b){var c=b.children(this.options.contentElement);if(c){var d=c.children();c.css("width",d.outerWidth()*d.length+"px");var e=a(window),f=e.height()+e.scrollTop(),g=e.width(),h=b.offset().top,i=b.outerHeight(),j=b.offset().left+b.outerWidth(),k=j+c.outerWidth();k>=g?c.addClass("push-left"):c.removeClass("push-left"),h>f/2?c.css("top","-"+(c.outerHeight()-i)+"px"):c.css("top",0),b.addClass(Toolkit.options.isPrefix+"open"),this.fireEvent("showChild",b)}},onShow:function(b){var c=a(b.target),d=this.node&&c[0]===this.node[0];if(this.isVisible()){if(Toolkit.isTouch?d&&"a"===this.node.prop("tagName").toLowerCase()||b.preventDefault():b.preventDefault(),"click"===this.options.mode&&this.hide(),d)return}else b.preventDefault();this.show(c)}},{mode:"hover",getUrl:"href",xOffset:0,yOffset:0,showDelay:350,hideDelay:1e3,itemLimit:15,contentElement:".flyout",template:'<div class="flyout"></div>'}),Toolkit.createComponent("flyout",function(a,b){return new Toolkit.Flyout(this,a,b)},!0)}(jQuery);