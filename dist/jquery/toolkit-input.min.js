/*!
 * Titon Toolkit v1.1.0-rc.1
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Input=Toolkit.Component.create(function(a,b){this.component="Input",this.version="0.0.0",this.options=b=this.setOptions(b),this.element=a=this.setElement(a),b.checkbox&&a.find(b.checkbox).inputCheckbox(b),b.radio&&a.find(b.radio).inputRadio(b),b.select&&a.find(b.select).inputSelect(b),this.fireEvent("init")},{buildWrapper:function(){var b=a("<div/>").addClass(Toolkit.options.vendor+"custom-input").insertBefore(this.input).append(this.input);return this.options.copyClasses&&this.copyClasses(this.input,b),b},copyClasses:function(b,c){var d=(a(b).attr("class")||"").replace(/\binput\b/,"").trim();return d&&a(c).addClass(d),this}},{checkbox:"input:checkbox",radio:"input:radio",select:"select"}),Toolkit.Input.Checkbox=Toolkit.Input.create(function(b,c){this.component="Input.Checkbox",this.version="0.0.0",this.options=this.setOptions(c),this.input=a(b),this.wrapper=this.buildWrapper(),this.element=this.setElement(a("<label/>").addClass(Toolkit.options.vendor+"checkbox").attr("for",this.input.attr("id")).insertAfter(this.input),this.options),this.fireEvent("init")},{},{copyClasses:!0}),Toolkit.Input.Radio=Toolkit.Input.create(function(b,c){this.component="Input.Radio",this.version="0.0.0",this.options=this.setOptions(c),this.input=a(b),this.wrapper=this.buildWrapper(),this.element=this.setElement(a("<label/>").addClass(Toolkit.options.vendor+"radio").attr("for",this.input.attr("id")).insertAfter(this.input),this.options),this.fireEvent("init")},{},{copyClasses:!0}),Toolkit.Input.Select=Toolkit.Input.create(function(b,c){this.component="Input.Select",this.version="0.0.0",this.options=c=this.setOptions(c),this.input=b=a(b),this.multiple=b.prop("multiple"),this.multiple&&c.native||(this.wrapper=this.buildWrapper(),this.element=this.buildButton(),this.dropdown=null,this.currentIndex=0,this.input.change(this.__change.bind(this)),this.options.native||(this.buildDropdown(),this.input.css("z-index",1).blur(this.hide.bind(this)),this.dropdown.clickout(this.hide.bind(this)),this.element.clickout(this.hide.bind(this)).click(this.__toggle.bind(this))),this.multiple||a(window).keydown(this.__cycle.bind(this)),this.input.change(),this.fireEvent("init"))},{buildButton:function(){var b=Toolkit.options.vendor,c=a("<div/>").addClass(b+"select").append(a("<div/>").addClass(b+"select-arrow").html(this.options.arrowContent)).append(a("<div/>").addClass(b+"select-label").html(Toolkit.options.loadingMessage)).css("min-width",this.input.width()).insertAfter(this.input);return this.multiple&&this.input.css("max-height",c.height()),c},buildDropdown:function(){var b=Toolkit.options.vendor,c=this.input,d=this.options,e=this.buildOption.bind(this),f=a("<div/>").addClass(b+"drop--down").addClass(b+"select-options"),g=a("<ul/>"),h=0,i=this;return this.dropdown=f,c.children().each(function(){var c=a(this);"optgroup"===c.prop("tagName").toLowerCase()?(0===h&&(d.hideFirst=!1),g.append(a("<li/>").addClass(b+"drop-heading").text(c.attr("label"))),c.children().each(function(){var b=a(this);c.prop("disabled")&&b.prop("disabled",!0),b.prop("selected")&&(i.currentIndex=h),g.append(e(b,h)),h++})):(c.prop("selected")&&(i.currentIndex=h),g.append(e(c,h)),h++)}),d.hideSelected&&!d.multiple&&f.addClass("hide-selected"),d.hideFirst&&f.addClass("hide-first"),this.multiple&&f.addClass(Toolkit.options.isPrefix+"multiple"),this.wrapper.append(f.append(g)),this},buildOption:function(b,c){var d,e=this.input,f=this.dropdown,g=Toolkit.options.isPrefix+"active",h=a("<li/>"),i=b.text();b.prop("selected")&&h.addClass(g),(d=this.readValue(b,this.options.getDescription))&&(i+=' <span class="'+Toolkit.options.vendor+'drop-desc">'+d+"</span>");var j=a("<a/>").html(i).attr("href","javascript:;");if(this.options.copyClasses&&this.copyClasses(b,h),h.append(j),b.prop("disabled"))return h.addClass(Toolkit.options.isPrefix+"disabled"),h;if(this.multiple)j.click(function(){b.prop("selected")?(b.prop("selected",!1),a(this).parent().removeClass(g)):(b.prop("selected",!0),a(this).parent().addClass(g)),e.change()});else{var k=this;j.click(function(){f.find("li").removeClass(g),a(this).parent().addClass(g),k.hide(),k.currentIndex=c,e.val(b.val()),e.change()})}return h},hide:function(){return this.element.removeClass(Toolkit.options.isPrefix+"active"),this.dropdown&&this.dropdown.conceal(),this.fireEvent("hide"),this},show:function(){return this.element.addClass(Toolkit.options.isPrefix+"active"),this.dropdown&&this.dropdown.reveal(),this.fireEvent("show"),this},__change:function(b){var c=a(b.target),d=c.find("option"),e=[],f=[],g=this;if(d.each(function(){this.selected&&(e.push(this),f.push(g.readValue(this,g.options.getOptionLabel)||this.textContent))}),this.multiple){var h=this.readValue(c,this.options.getDefaultLabel),i=this.options.multipleFormat,j=f.length;if(!f.length&&h)f=h;else if("count"===i)f=this.options.countMessage.replace("{count}",j).replace("{total}",d.length);else if("list"===i){var k=this.options.listLimit;f=f.splice(0,k).join(", "),j>k&&(f+=" ...")}}else f=f.join(", ");c.parent().find("."+Toolkit.options.vendor+"select-label").text(f),this.fireEvent("change",[c.val(),e])},__cycle:function(b){if(this.dropdown.is(":shown")&&a.inArray(b.keyCode,[38,40,13,27])>=0){b.preventDefault();var c=this.input.find("option"),d=this.dropdown.find("a"),e=Toolkit.options.isPrefix+"active",f=this.currentIndex;switch(b.keyCode){case 13:case 27:return void this.hide();case 38:f=this.__loop(f,-1,c);break;case 40:f=this.__loop(f,1,c)}c.prop("selected",!1),c[f].selected=!0,d.parent().removeClass(e),d.item(f).parent().addClass(e),this.currentIndex=f,this.input.change()}},__loop:function(a,b,c){var d=this.options.hideFirst;for(a+=b;"undefined"==typeof c[a]||c[a].disabled||0===a&&d;)a+=b,a>=c.length?a=0:0>a&&(a=c.length-1);return a},__toggle:function(){this.enabled&&!this.input.prop("disabled")&&(this.dropdown.is(":shown")?this.hide():this.show())}},{copyClasses:!0,"native":!1,multipleFormat:"count",countMessage:"{count} of {total} selected",listLimit:3,hideFirst:!1,hideSelected:!1,arrowContent:'<span class="caret-down"></span>',getDefaultLabel:"title",getOptionLabel:"title",getDescription:"data-description"}),Toolkit.createComponent("input",function(a){return new Toolkit.Input(this,a)}),Toolkit.createComponent("inputRadio",function(a){return new Toolkit.Input.Radio(this,a)}),Toolkit.createComponent("inputCheckbox",function(a){return new Toolkit.Input.Checkbox(this,a)}),Toolkit.createComponent("inputSelect",function(a){return new Toolkit.Input.Select(this,a)})}(jQuery);