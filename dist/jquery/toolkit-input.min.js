/*!
 * Titon Toolkit v1.1.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Input=Toolkit.Component.extend(function(b,c){this.component="Input",this.version="1.1.0",this.element=b=a(b),this.options=c=this.setOptions(c,b),c.checkbox&&b.find(c.checkbox).inputCheckbox(c),c.radio&&b.find(c.radio).inputRadio(c),c.select&&b.find(c.select).inputSelect(c),this.enable(),this.fireEvent("init")},{copyClasses:function(b,c){var d=(a(b).attr("class")||"").replace(/\binput\b/,"").trim();d&&a(c).addClass(d)},_buildWrapper:function(){var b=a("<div/>").addClass(Toolkit.options.vendor+"custom-input").insertBefore(this.input).append(this.input);return this.options.copyClasses&&this.copyClasses(this.input,b),b}},{checkbox:"input:checkbox",radio:"input:radio",select:"select"}),Toolkit.InputCheckbox=Toolkit.Input.extend(function(b,c){this.component="InputCheckbox",this.version="1.1.0",this.input=b=a(b),this.options=this.setOptions(c,b),this.wrapper=this._buildWrapper(),this.element=a("<label/>").addClass(Toolkit.options.vendor+"checkbox").attr("for",this.input.attr("id")).insertAfter(this.input),this.enable(),this.fireEvent("init")},{},{copyClasses:!0}),Toolkit.InputRadio=Toolkit.Input.extend(function(b,c){this.component="InputRadio",this.version="1.1.0",this.input=b=a(b),this.options=this.setOptions(c,b),this.wrapper=this._buildWrapper(),this.element=a("<label/>").addClass(Toolkit.options.vendor+"radio").attr("for",this.input.attr("id")).insertAfter(this.input),this.enable(),this.fireEvent("init")},{},{copyClasses:!0}),Toolkit.InputSelect=Toolkit.Input.extend(function(b,c){var d;this.component="InputSelect",this.version="1.1.0",this.input=b=a(b),this.multiple=b.prop("multiple"),this.options=c=this.setOptions(c,b),this.multiple&&c.native||(this.wrapper=this._buildWrapper(),this.element=this._buildButton(),this.dropdown=null,this.index=0,this.events=d={"change input":"onChange"},c.native||(d["blur input"]="hide",d["clickout dropdown"]="hide",d["clickout element"]="hide",d["click element"]="onToggle",this.multiple||(d["keydown window"]="onCycle"),this._buildDropdown(),this.input.css("z-index",1)),this.enable(),this.fireEvent("init"),this.input.change())},{hide:function(){this.element.removeClass(Toolkit.options.isPrefix+"active"),this.dropdown&&this.dropdown.conceal(),this.fireEvent("hide")},show:function(){this.element.addClass(Toolkit.options.isPrefix+"active"),this.dropdown&&this.dropdown.reveal(),this.fireEvent("show")},_buildButton:function(){var b=Toolkit.options.vendor,c=a("<div/>").addClass(b+"select").append(a("<div/>").addClass(b+"select-arrow").html(this.options.arrowContent)).append(a("<div/>").addClass(b+"select-label").html(Toolkit.messages.loading)).css("min-width",this.input.width()).insertAfter(this.input);return this.multiple&&this.input.css("max-height",c.height()),c},_buildDropdown:function(){var b=Toolkit.options.vendor,c=this.input,d=this.options,e=this._buildOption.bind(this),f=a("<div/>").addClass(b+"drop--down").addClass(b+"select-options"),g=a("<ul/>"),h=0,i=this;return this.dropdown=f,c.children().each(function(){var c=a(this);"optgroup"===c.prop("tagName").toLowerCase()?(0===h&&(d.hideFirst=!1),g.append(a("<li/>").addClass(b+"drop-heading").text(c.attr("label"))),c.children().each(function(){var b=a(this);c.prop("disabled")&&b.prop("disabled",!0),b.prop("selected")&&(i.index=h),g.append(e(b,h)),h++})):(c.prop("selected")&&(i.index=h),g.append(e(c,h)),h++)}),d.hideSelected&&!d.multiple&&f.addClass("hide-selected"),d.hideFirst&&f.addClass("hide-first"),this.multiple&&f.addClass(Toolkit.options.isPrefix+"multiple"),this.wrapper.append(f.append(g)),f},_buildOption:function(b,c){var d,e=this.input,f=this.dropdown,g=Toolkit.options.isPrefix,h=g+"active",i=a("<li/>"),j=b.text();b.prop("selected")&&i.addClass(h),(d=this.readValue(b,this.options.getDescription))&&(j+=' <span class="'+Toolkit.options.vendor+'drop-desc">'+d+"</span>");var k=a("<a/>").html(j).attr("href","javascript:;");if(this.options.copyClasses&&this.copyClasses(b,i),i.append(k),b.prop("disabled"))return i.addClass(g+"disabled"),i;if(this.multiple)k.click(function(){b.prop("selected")?(b.prop("selected",!1),a(this).parent().removeClass(h)):(b.prop("selected",!0),a(this).parent().addClass(h)),e.change()});else{var l=this;k.click(function(){f.find("li").removeClass(h),a(this).parent().addClass(h),l.hide(),l.index=c,e.val(b.val()),e.change()})}return i},_loop:function(a,b,c){var d=this.options.hideFirst;for(a+=b;"undefined"==typeof c[a]||c[a].disabled||0===a&&d;)a+=b,a>=c.length?a=0:0>a&&(a=c.length-1);return a},onChange:function(b){var c=a(b.target),d=c.find("option"),e=this.options,f=[],g=[],h=this;if(d.each(function(){this.selected&&(f.push(this),g.push(h.readValue(this,e.getOptionLabel)||this.textContent))}),this.multiple){var i=this.readValue(c,e.getDefaultLabel),j=e.multipleFormat,k=g.length;if(!g.length&&i)g=i;else if("count"===j)g=e.countMessage.replace("{count}",k).replace("{total}",d.length);else if("list"===j){var l=e.listLimit;g=g.splice(0,l).join(", "),k>l&&(g+=" ...")}}else g=g.join(", ");c.parent().find("."+Toolkit.options.vendor+"select-label").text(g),this.fireEvent("change",[c.val(),f])},onCycle:function(b){if(this.dropdown.is(":shown")&&a.inArray(b.keyCode,[38,40,13,27])>=0){b.preventDefault();var c=this.input.find("option"),d=this.dropdown.find("a"),e=Toolkit.options.isPrefix+"active",f=this.index;switch(b.keyCode){case 13:case 27:return void this.hide();case 38:f=this._loop(f,-1,c);break;case 40:f=this._loop(f,1,c)}c.prop("selected",!1),c[f].selected=!0,d.parent().removeClass(e),d.item(f).parent().addClass(e),this.index=f,this.input.change()}},onToggle:function(){this.input.prop("disabled")||(this.dropdown.is(":shown")?this.hide():this.show())}},{copyClasses:!0,"native":!1,multipleFormat:"count",countMessage:"{count} of {total} selected",listLimit:3,hideFirst:!1,hideSelected:!1,arrowContent:'<span class="caret-down"></span>',getDefaultLabel:"title",getOptionLabel:"title",getDescription:"data-description"}),Toolkit.createComponent("input",function(a){return new Toolkit.Input(this,a)}),Toolkit.createComponent("inputRadio",function(a){return new Toolkit.InputRadio(this,a)}),Toolkit.createComponent("inputCheckbox",function(a){return new Toolkit.InputCheckbox(this,a)}),Toolkit.createComponent("inputSelect",function(a){return new Toolkit.InputSelect(this,a)})}(jQuery);