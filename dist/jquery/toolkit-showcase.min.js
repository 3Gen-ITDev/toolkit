/*!
 * Titon Toolkit v1.0.1
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Showcase=Toolkit.Component.create(function(b,c){this.options=this.setOptions(Toolkit.Showcase.options,c),this.nodes=a(b),this.element=this.createElement(this.options),this.items=null,this.tabs=null,this.prevButton=null,this.nextButton=null,this.data=[],this.previousIndex=0,this.currentIndex=0,this.blackout=null,this.initialize=function(){var b=this.options;(Toolkit.ie8||Toolkit.ie9)&&(this.options.transition=1),this.items=this.element.find(b.itemsElement),this.tabs=this.element.find(b.tabsElement),this.prevButton=this.element.find(b.prevElement),this.nextButton=this.element.find(b.nextElement),b.blackout&&(this.blackout=new Toolkit.Blackout,this.blackout.element.on("click",this.hide.bind(this))),a(b.context||document).on("click",this.nodes.selector,this.__show.bind(this)),a(window).on("keydown",function(b){if(this.element.is(":shown"))switch(a.inArray(b.keyCode,[37,38,39,40])>=0&&b.preventDefault(),b.keyCode){case 27:this.hide();break;case 37:this.prev();break;case 38:this.jump(0);break;case 39:this.next();break;case 40:this.jump(-1)}}.bind(this)),this.element.on("click",b.closeEvent,this.hide.bind(this)).on("click swipeleft",b.nextEvent,this.next.bind(this)).on("click swiperight",b.prevEvent,this.prev.bind(this)).on("click",b.jumpEvent,this.__jump.bind(this)),this.fireEvent("init")},this.hide=function(){return this.element.is(":shown")&&(this.element.conceal(),this.element.removeClass(Toolkit.options.isPrefix+"single"),this.options.blackout&&this.blackout.hide(),this.items.removeAttr("style").children("li").removeClass("show"),this.fireEvent("hide")),this},this.jump=function(b){b>=this.data.length?b=0:0>b&&(b=this.data.length-1);var c=this,d=this.options,e=this.element,f=this.items,g=f.children("li"),h=g.item(b),i=this.data,j=i[b];if(this.previousIndex=this.currentIndex,this.currentIndex=b,this.tabs){var k=this.tabs.find("a");k.removeClass(Toolkit.options.isPrefix+"active").item(b).addClass(Toolkit.options.isPrefix+"active")}if(g.removeClass("show"),h.data("width"))this._resize(h.data("width"),h.data("height")),setTimeout(function(){h.addClass("show"),c._reposition()},d.transition);else{e.addClass(Toolkit.options.isPrefix+"loading");var l=new Image;l.src=j.image,l.onload=function(){c._resize(this.width,this.height),h.data("width",this.width).data("height",this.height),j.title&&h.append(a("<div/>").addClass(Toolkit.options.vendor+"showcase-caption").html(j.title)),setTimeout(function(){e.removeClass(Toolkit.options.isPrefix+"loading"),h.addClass("show").append(l),c._reposition()},d.transition)}}return this.fireEvent("jump",b),this},this.next=function(){return this.jump(this.currentIndex+1),this},this.position=function(){return this.element.is(":shown")||(this.options.blackout&&this.blackout.show(),this.element.reveal(),this._reposition()),this.fireEvent("show"),this},this.prev=function(){return this.jump(this.currentIndex-1),this},this.show=function(b){this.node=b=a(b),this.currentIndex=this.previousIndex=0,this.element.addClass(Toolkit.options.isPrefix+"loading");var c=this.options,d=this.readValue.bind(this),e=d(b,c.getCategory),f=[],g=0;if(e)for(var h,i=0,j=0;h=this.nodes[i];i++)d(h,c.getCategory)===e&&(h===b&&(g=j),f.push({title:d(h,c.getTitle),category:e,image:d(h,c.getImage)}),j++);else f.push({title:d(b,c.getTitle),category:e,image:d(b,c.getImage)});return this._buildItems(f),this.position(),this.jump(g),this},this._buildItems=function(b){this.data=b,this.items.empty(),this.tabs.empty();for(var c,d,e,f=0;e=b[f];f++)c=a("<li/>"),c.appendTo(this.items),d=a("<a/>").addClass(this.options.jumpEvent.substr(1)).attr("href","javascript:;").data("index",f),c=a("<li/>"),c.appendTo(this.tabs).append(d);return b.length<=1&&this.element.addClass(Toolkit.options.isPrefix+"single"),this.fireEvent("load",b),this},this._reposition=function(){return Toolkit.ie8?(this.element.css({"margin-left":-(this.element.outerWidth(!0)/2),"margin-top":-(this.element.outerHeight(!0)/2)}),this):this},this._resize=function(b,c){var d,e,f=a(window).width(),g=a(window).height();if(b>f){var h=f-2*this.options.gutter;d=b/c,e=b-h,b=h,c-=Math.round(e/d)}else if(c>g){var i=g-2*this.options.gutter;d=c/b,e=c-i,b-=Math.round(e/d),c=i}return this.items.css({width:b,height:c}),this},this.__jump=function(b){b.preventDefault(),b.stopPropagation(),this.jump(a(b.target).data("index")||0)},this.__show=function(a){a.preventDefault(),a.stopPropagation(),this.show(a.currentTarget)},this.initialize()}),Toolkit.Showcase.options={className:"",blackout:!0,transition:300,gutter:50,getCategory:"data-showcase",getImage:"href",getTitle:"title",itemsElement:".showcase-items",tabsElement:".showcase-tabs",prevElement:".showcase-prev",nextElement:".showcase-next",closeEvent:".showcase-event-close",jumpEvent:".showcase-event-jump",prevEvent:".showcase-event-prev",nextEvent:".showcase-event-next",template:'<div class="showcase"><div class="showcase-inner"><ul class="showcase-items"></ul><ol class="showcase-tabs bullets"></ol><a href="javascript:;" class="showcase-prev showcase-event-prev"><span class="arrow-left"></span></a><a href="javascript:;" class="showcase-next showcase-event-next"><span class="arrow-right"></span></a><a href="javascript:;" class="showcase-close showcase-event-close"><span class="x"></span></a></div></div>'},a.fn.showcase=function(b){var c=new Toolkit.Showcase(this,b);return this.each(function(){a(this).addData("toolkit.showcase",c)})}}(jQuery);