/*!
 * Titon Toolkit v1.2.1
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Showcase=Toolkit.Component.extend(function(b,c){var d,e;Toolkit.hasTransition||(c.transition=1),this.component="Showcase",this.version="1.2.0",this.options=c=this.setOptions(c),this.element=d=this.createElement(),this.nodes=b=a(b),this.items=d.find(c.itemsElement),this.tabs=d.find(c.tabsElement),this.prevButton=d.find(c.prevElement),this.nextButton=d.find(c.nextElement),this.data=[],this.index=0,this.blackout=c.blackout?Toolkit.Blackout.factory():null,c.gutter+=d.height()-this.items.height(),this.events=e={"clickout element":"hide","clickout nodes":"hide","swipeleft element":"next","swipeup element":"next","swiperight element":"prev","swipedown element":"prev","keydown window":"onKeydown"},e["click "+b.selector]="onShow",e["click "+c.closeEvent]="hide",e["click "+c.nextEvent]="next",e["click "+c.prevEvent]="prev",e["click "+c.jumpEvent]="onJump",this.enable(),this.fireEvent("init")},{hide:function(){this.blackout&&this.blackout.hide(),this.options.stopScroll&&a("body").removeClass("no-scroll"),this.element.is(":shown")&&(this.element.conceal().removeClass(Toolkit.options.isPrefix+"single"),this.items.removeAttr("style").children("li").removeClass("show"),this.fireEvent("hide"))},jump:function(b){b=a.bound(b,this.data.length);var c=this,d=this.options,e=this.element,f=this.items,g=f.children("li"),h=g.item(b),i=this.data,j=i[b],k=Toolkit.options.isPrefix;if(this.index=b,this.tabs){var l=this.tabs.find("a");l.removeClass(k+"active").item(b).addClass(k+"active")}if(g.removeClass("show"),h.data("width"))this._resize(h.data("width"),h.data("height")),setTimeout(function(){h.addClass("show"),c.position()},d.transition);else{e.addClass(k+"loading");var m=new Image;m.src=j.image,m.onload=function(){c._resize(this.width,this.height),h.data("width",this.width).data("height",this.height),j.title&&h.append(a("<div/>").addClass(Toolkit.options.vendor+"showcase-caption").html(j.title)),setTimeout(function(){e.removeClass(k+"loading"),h.addClass("show").append(m),c.position()},d.transition)}}this.fireEvent("jump",b)},next:function(){this.jump(this.index+1)},position:function(){this.blackout&&this.blackout.hideLoader(),this.element.reveal(),this.fireEvent("show")},prev:function(){this.jump(this.index-1)},show:function(b){this.node=b=a(b),this.index=0,this.element.addClass(Toolkit.options.isPrefix+"loading");var c=this.inheritOptions(this.options,b),d=this.readValue.bind(this),e=d(b,c.getCategory),f=[],g=0;if(e)for(var h,i=0,j=0;h=this.nodes[i];i++)d(h,c.getCategory)===e&&(h===b&&(g=j),f.push({title:d(h,c.getTitle),category:e,image:d(h,c.getImage)}),j++);else f.push({title:d(b,c.getTitle),category:e,image:d(b,c.getImage)});this.blackout&&this.blackout.show(),c.stopScroll&&a("body").addClass("no-scroll"),this._buildItems(f),this.jump(g)},_buildItems:function(b){this.data=b,this.items.empty(),this.tabs.empty();for(var c,d,e,f=0;e=b[f];f++)c=a("<li/>"),c.appendTo(this.items),d=a("<a/>").addClass(this.options.jumpEvent.substr(1)).attr("href","javascript:;").data("index",f),c=a("<li/>"),c.appendTo(this.tabs).append(d);b.length<=1&&this.element.addClass(Toolkit.options.isPrefix+"single"),this.fireEvent("load",b)},_resize:function(b,c){var d,e,f=a(window).width(),g=a(window).height(),h=this.options.gutter;if(b+h>f){var i=f-2*h;d=b/c,e=b-i,b=i,c-=Math.round(e/d)}else if(c+h>g){var j=g-2*h;d=c/b,e=c-j,b-=Math.round(e/d),c=j}this.items.css({width:b,height:c})},onJump:function(b){b.preventDefault(),this.jump(a(b.target).data("index")||0)},onKeydown:function(b){if(this.element.is(":shown"))switch(a.inArray(b.keyCode,[37,38,39,40])>=0&&b.preventDefault(),b.keyCode){case 27:this.hide();break;case 37:this.prev();break;case 38:this.jump(0);break;case 39:this.next();break;case 40:this.jump(-1)}},onShow:function(a){a.preventDefault(),this.show(a.currentTarget)}},{blackout:!0,stopScroll:!0,transition:300,gutter:50,getCategory:"data-showcase",getImage:"href",getTitle:"title",itemsElement:".showcase-items",tabsElement:".showcase-tabs",prevElement:".showcase-prev",nextElement:".showcase-next",closeEvent:".showcase-event-close",jumpEvent:".showcase-event-jump",prevEvent:".showcase-event-prev",nextEvent:".showcase-event-next",template:'<div class="showcase"><div class="showcase-inner"><ul class="showcase-items"></ul><ol class="showcase-tabs bullets"></ol><button type="button" class="showcase-prev showcase-event-prev"><span class="arrow-left"></span></button><button type="button" class="showcase-next showcase-event-next"><span class="arrow-right"></span></button><button type="button" class="showcase-close showcase-event-close"><span class="x"></span></button></div></div>'}),Toolkit.createComponent("showcase",function(a){return new Toolkit.Showcase(this,a)},!0)}(jQuery);