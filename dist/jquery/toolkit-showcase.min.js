/*!
 * Titon Toolkit v1.1.0-rc.2
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Showcase=Toolkit.Component.extend(function(b,c){var d;this.component="Showcase",this.version="1.1.0",this.options=c=this.setOptions(c),this.element=d=this.createElement(),Toolkit.hasTransition||(c.transition=1),this.nodes=b=a(b),this.items=d.find(c.itemsElement),this.tabs=d.find(c.tabsElement),c.gutter+=d.height()-this.items.height(),this.prevButton=d.find(c.prevElement),this.nextButton=d.find(c.nextElement),this.data=[],this.previousIndex=0,this.currentIndex=0,this.blackout=c.blackout?Toolkit.Blackout.factory():null,d.clickout(this.hide.bind(this)),b.clickout(this.hide.bind(this)),a(c.context||document).on("click",b.selector,this.__show.bind(this)),a(window).on("keydown",function(b){if(d.is(":shown"))switch(a.inArray(b.keyCode,[37,38,39,40])>=0&&b.preventDefault(),b.keyCode){case 27:this.hide();break;case 37:this.prev();break;case 38:this.jump(0);break;case 39:this.next();break;case 40:this.jump(-1)}}.bind(this)),d.on("click",c.closeEvent,this.hide.bind(this)).on("click swipeleft",c.nextEvent,this.next.bind(this)).on("click swiperight",c.prevEvent,this.prev.bind(this)).on("click",c.jumpEvent,this.__jump.bind(this)),this.fireEvent("init")},{hide:function(){this.blackout&&this.blackout.hide(),this.options.stopScroll&&a("body").css("overflow",""),this.element.is(":shown")&&(this.element.conceal().removeClass(Toolkit.options.isPrefix+"single"),this.items.removeAttr("style").children("li").removeClass("show"),this.fireEvent("hide"))},jump:function(b){b>=this.data.length?b=0:0>b&&(b=this.data.length-1);var c=this,d=this.options,e=this.element,f=this.items,g=f.children("li"),h=g.item(b),i=this.data,j=i[b];if(this.previousIndex=this.currentIndex,this.currentIndex=b,this.tabs){var k=this.tabs.find("a");k.removeClass(Toolkit.options.isPrefix+"active").item(b).addClass(Toolkit.options.isPrefix+"active")}if(g.removeClass("show"),h.data("width"))this._resize(h.data("width"),h.data("height")),setTimeout(function(){h.addClass("show"),c.position()},d.transition);else{e.addClass(Toolkit.options.isPrefix+"loading");var l=new Image;l.src=j.image,l.onload=function(){c._resize(this.width,this.height),h.data("width",this.width).data("height",this.height),j.title&&h.append(a("<div/>").addClass(Toolkit.options.vendor+"showcase-caption").html(j.title)),setTimeout(function(){e.removeClass(Toolkit.options.isPrefix+"loading"),h.addClass("show").append(l),c.position()},d.transition)}}this.fireEvent("jump",b)},next:function(){this.jump(this.currentIndex+1)},position:function(){this.blackout&&this.blackout.hideLoader(),this.element.reveal(),this.fireEvent("show")},prev:function(){this.jump(this.currentIndex-1)},show:function(b){this.node=b=a(b),this.currentIndex=this.previousIndex=0,this.element.addClass(Toolkit.options.isPrefix+"loading");var c=this.options,d=this.readValue.bind(this),e=d(b,c.getCategory),f=[],g=0;if(e)for(var h,i=0,j=0;h=this.nodes[i];i++)d(h,c.getCategory)===e&&(h===b&&(g=j),f.push({title:d(h,c.getTitle),category:e,image:d(h,c.getImage)}),j++);else f.push({title:d(b,c.getTitle),category:e,image:d(b,c.getImage)});this.blackout&&this.blackout.show(),c.stopScroll&&a("body").css("overflow","hidden"),this._buildItems(f),this.jump(g)},_buildItems:function(b){this.data=b,this.items.empty(),this.tabs.empty();for(var c,d,e,f=0;e=b[f];f++)c=a("<li/>"),c.appendTo(this.items),d=a("<a/>").addClass(this.options.jumpEvent.substr(1)).attr("href","javascript:;").data("index",f),c=a("<li/>"),c.appendTo(this.tabs).append(d);b.length<=1&&this.element.addClass(Toolkit.options.isPrefix+"single"),this.fireEvent("load",b)},_resize:function(b,c){var d,e,f=a(window).width(),g=a(window).height(),h=this.options.gutter;if(b+h>f){var i=f-2*h;d=b/c,e=b-i,b=i,c-=Math.round(e/d)}else if(c+h>g){var j=g-2*h;d=c/b,e=c-j,b-=Math.round(e/d),c=j}this.items.css({width:b,height:c})},__jump:function(b){b.preventDefault(),this.jump(a(b.target).data("index")||0)},__show:function(a){a.preventDefault(),this.show(a.currentTarget)}},{className:"",blackout:!0,stopScroll:!0,transition:300,gutter:50,getCategory:"data-showcase",getImage:"href",getTitle:"title",itemsElement:".showcase-items",tabsElement:".showcase-tabs",prevElement:".showcase-prev",nextElement:".showcase-next",closeEvent:".showcase-event-close",jumpEvent:".showcase-event-jump",prevEvent:".showcase-event-prev",nextEvent:".showcase-event-next",template:'<div class="showcase"><div class="showcase-inner"><ul class="showcase-items"></ul><ol class="showcase-tabs bullets"></ol><a href="javascript:;" class="showcase-prev showcase-event-prev"><span class="arrow-left"></span></a><a href="javascript:;" class="showcase-next showcase-event-next"><span class="arrow-right"></span></a><a href="javascript:;" class="showcase-close showcase-event-close"><span class="x"></span></a></div></div>'}),Toolkit.createComponent("showcase",function(a){return new Toolkit.Showcase(this,a)},!0)}(jQuery);