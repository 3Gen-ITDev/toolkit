/*!
 * Titon Toolkit v1.1.0-rc.1
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Modal=Toolkit.Component.create(function(b,c){this.component="Modal",this.version="0.0.0",this.options=this.setOptions(Toolkit.Modal.options,c),this.nodes=a(b),this.node=null,this.element=this.createElement(this.options),this.elementBody=null,this.blackout=null,this.drag=null,this.cache={},this.initialize()}),Toolkit.Modal.options={animation:"fade",className:"",context:null,ajax:!0,draggable:!1,blackout:!0,fullScreen:!1,stopScroll:!0,getContent:"data-modal",contentElement:".modal-inner",closeElement:".modal-close",closeEvent:".modal-event-close",submitEvent:".modal-event-submit",template:'<div class="modal"><div class="modal-handle"><div class="modal-inner"></div><a href="javascript:;" class="modal-close modal-event-close"><span class="x"></span></a></div></div>'};var b=Toolkit.Modal.prototype;b.initialize=function(){var b=this.options;if(b.fullScreen&&(this.element.addClass(Toolkit.options.isPrefix+"fullscreen"),b.draggable=!1),this.elementBody=this.element.find(b.contentElement),b.draggable&&a.ui&&a.ui.draggable){var c=Toolkit.options.isPrefix;this.drag=this.element.draggable({appendTo:"body",containment:"window",cursor:"grabbing",start:function(a,b){b.helper.addClass(c+"dragging")},stop:function(a,b){b.helper.removeClass(c+"dragging")}}),this.element.addClass(c+"draggable")}b.blackout&&(this.blackout=Toolkit.Blackout.factory(),this.blackout.element.click(this.__hide.bind(this)),b.stopScroll&&this.blackout.element.on("hide.toolkit.blackout",function(b,c){c&&a("body").css("overflow","")})),this.element.clickout(this.__hide.bind(this)),this.nodes.clickout(this.__hide.bind(this)),a(b.context||document).on("click",this.nodes.selector,this.__show.bind(this)),a(window).on("keydown",function(a){27===a.keyCode&&this.element.is(":shown")&&this.hide()}.bind(this)),this.element.on("click",b.closeEvent,this.__hide.bind(this)).on("click",b.submitEvent,this.__submit.bind(this)),this.fireEvent("init")},b.hide=function(){return this.element.conceal(),this.blackout&&this.blackout.hide(),this.fireEvent("hide"),this},b.position=function(b){return b===!0?this:(this.elementBody.html(b),this.fireEvent("load",b),this.blackout&&this.blackout.hideLoader(),this.element.reveal(),this.options.fullScreen?this.element.find(this.options.contentElement).css("min-height",a(window).height()):Toolkit.hasTransform||this.element.css({"margin-left":-(this.element.outerWidth(!0)/2),"margin-top":-(this.element.outerHeight(!0)/2)}),this.fireEvent("show"),this)},b.show=function(b,c){b=a(b);var d=this.options,e=d.ajax;return c?e=!1:b&&(c=this.readValue(b,d.getContent)||b.attr("href"),c&&c.match(/^#[a-z0-9_\-\.:]+$/i)&&(c=a(c).html(),e=!1)),c?(this.node=b,this.blackout&&this.blackout.show(),d.stopScroll&&a("body").css("overflow","hidden"),e?this.cache[c]?this.position(this.cache[c]):this.requestData(c):this.position(c),this):this},b.__hide=function(a){a.preventDefault(),this.hide()},b.__show=function(a){a.preventDefault(),this.enabled&&this.show(a.currentTarget)},b.__submit=function(b){b.preventDefault();var c=a(b.target),d=this.elementBody.find("form:first");if(d){this.fireEvent("submit",[c,d]);var e={url:d.attr("action"),type:(d.attr("method")||"post").toUpperCase()};window.FormData?(e.processData=!1,e.contentType=!1,e.data=new FormData(d[0])):e.data=d.serialize(),this.requestData(e)}},a.fn.modal=function(b){var c=new Toolkit.Modal(this,b);return this.each(function(){a(this).addData("toolkit.modal",c)})}}(jQuery);