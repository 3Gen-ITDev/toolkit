/*!
 * Titon Toolkit v1.0.2
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Modal=Toolkit.Component.create(function(b,c){this.options=this.setOptions(Toolkit.Modal.options,c),this.nodes=a(b),this.node=null,this.element=this.createElement(this.options),this.elementBody=null,this.blackout=null,this.drag=null,this.cache={},this.enabled=!0,this.initialize=function(){var b=this.options;b.fullScreen&&(this.element.addClass(Toolkit.options.isPrefix+"fullscreen"),b.draggable=!1),this.elementBody=this.element.find(b.contentElement),b.draggable&&a.ui&&a.ui.draggable&&(this.drag=this.element.draggable({appendTo:"body",containment:"window",cursor:"grabbing",start:function(a,b){b.helper.addClass(Toolkit.options.isPrefix+"dragging")},stop:function(a,b){b.helper.removeClass(Toolkit.options.isPrefix+"dragging")}}),this.element.addClass(Toolkit.options.isPrefix+"draggable")),b.blackout&&(this.blackout=new Toolkit.Blackout,this.blackout.element.on("click",this.__hide.bind(this))),a(b.context||document).on("click",this.nodes.selector,this.__show.bind(this)),a(window).on("keydown",function(a){27===a.keyCode&&this.element.is(":shown")&&this.hide()}.bind(this)),this.element.on("click",b.closeEvent,this.__hide.bind(this)).on("click",b.submitEvent,this.__submit.bind(this)),this.fireEvent("init")},this.hide=function(){return this.element.conceal(),this.options.blackout&&this.blackout.hide(),this.fireEvent("hide"),this},this.position=function(b){return b===!0?this:(this.elementBody.html(b),this.fireEvent("load",b),this.element.is(":shown")||(this.options.blackout&&this.blackout.show(),this.options.fullScreen&&this.element.find(this.options.contentElement).css("min-height",a(window).height()),this.element.reveal(),Toolkit.ie8&&!this.options.fullScreen&&this.element.css({"margin-left":-(this.element.outerWidth(!0)/2),"margin-top":-(this.element.outerHeight(!0)/2)})),this.fireEvent("show"),this)},this.show=function(b,c){b=a(b);var d=this.options,e=d.ajax;return c?d.ajax=!1:b&&(c=this.readValue(b,d.getContent)||b.attr("href"),c&&"#"===c.substr(0,1)&&(c=a(c).html(),d.ajax=!1)),c?(this.node=b,d.ajax?this.cache[c]?this.position(this.cache[c]):this.requestData("modal",c):this.position(c),this.options.ajax=e,this):this},this.__hide=function(a){a.preventDefault(),this.hide()},this.__show=function(a){a.preventDefault(),a.stopPropagation(),this.enabled&&this.show(a.currentTarget)},this.__submit=function(b){b.preventDefault(),b.stopPropagation();var c=a(b.target),d=this.elementBody.find("form");d&&(this.fireEvent("submit",c),a.ajax({url:d.attr("action"),type:(d.attr("method")||"post").toUpperCase(),data:d.serialize(),success:function(a){this.position(a)}.bind(this),error:function(){this.position(this._errorTemplate("modal"))}.bind(this)}))},this.initialize()}),Toolkit.Modal.options={animation:"fade",className:"",context:null,ajax:!0,draggable:!1,blackout:!0,showLoading:!0,fullScreen:!1,getContent:"data-modal",contentElement:".modal-inner",closeElement:".modal-close",closeEvent:".modal-event-close",submitEvent:".modal-event-submit",template:'<div class="modal"><div class="modal-handle"><div class="modal-inner"></div><a href="javascript:;" class="modal-close modal-event-close"><span class="x"></span></a></div></div>'},a.fn.modal=function(b){var c=new Toolkit.Modal(this,b);return this.each(function(){a(this).addData("toolkit.modal",c)})}}(jQuery);