/*!
 * Titon Toolkit v1.1.0-rc.2
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Modal=Toolkit.Component.extend(function(b,c){var d;if(this.component="Modal",this.version="1.1.0",this.options=c=this.setOptions(c),this.element=d=this.createElement(),this.nodes=b=a(b),this.node=null,this.elementBody=d.find(c.contentElement),this.blackout=null,this.drag=null,this.cache={},c.fullScreen&&(d.addClass(Toolkit.options.isPrefix+"fullscreen"),c.draggable=!1),c.draggable&&a.ui&&a.ui.draggable){var e=Toolkit.options.isPrefix;this.drag=d.draggable({appendTo:"body",containment:"window",cursor:"grabbing",start:function(a,b){b.helper.addClass(e+"dragging")},stop:function(a,b){b.helper.removeClass(e+"dragging")}}),d.addClass(e+"draggable")}c.blackout&&(this.blackout=Toolkit.Blackout.factory(),c.stopScroll&&this.blackout.element.on("hide.toolkit.blackout",function(b,c){c&&a("body").css("overflow","")})),d.clickout(this.__hide.bind(this)),b.clickout(this.__hide.bind(this)),a(c.context||document).on("click",b.selector,this.__show.bind(this)),a(window).on("keydown",function(a){27===a.keyCode&&d.is(":shown")&&this.hide()}.bind(this)),d.on("click",c.closeEvent,this.__hide.bind(this)).on("click",c.submitEvent,this.__submit.bind(this)),this.fireEvent("init")},{hide:function(){this.element.conceal(),this.blackout&&this.blackout.hide(),this.fireEvent("hide")},position:function(b){b!==!0&&(this.elementBody.html(b),this.fireEvent("load",b),this.blackout&&this.blackout.hideLoader(),this.element.reveal(),this.options.fullScreen&&this.element.find(this.options.contentElement).css("min-height",a(window).height()),this.fireEvent("show"))},show:function(b,c){b=a(b);var d=this.options,e=d.ajax;c?e=!1:b&&(c=this.readValue(b,d.getContent)||b.attr("href"),c&&c.match(/^#[a-z0-9_\-\.:]+$/i)&&(c=a(c).html(),e=!1)),c&&(this.node=b,this.blackout&&this.blackout.show(),d.stopScroll&&a("body").css("overflow","hidden"),e?this.cache[c]?this.position(this.cache[c]):this.requestData(c):this.position(c))},__hide:function(a){a.preventDefault(),this.hide()},__show:function(a){a.preventDefault(),this.enabled&&this.show(a.currentTarget)},__submit:function(b){b.preventDefault();var c=a(b.target),d=this.elementBody.find("form:first");if(d){this.fireEvent("submit",[c,d]);var e={url:d.attr("action"),type:(d.attr("method")||"post").toUpperCase()};window.FormData?(e.processData=!1,e.contentType=!1,e.data=new FormData(d[0])):e.data=d.serialize(),this.requestData(e)}}},{animation:"fade",className:"",context:null,ajax:!0,draggable:!1,blackout:!0,fullScreen:!1,stopScroll:!0,getContent:"data-modal",contentElement:".modal-inner",closeElement:".modal-close",closeEvent:".modal-event-close",submitEvent:".modal-event-submit",template:'<div class="modal"><div class="modal-handle"><div class="modal-inner"></div><a href="javascript:;" class="modal-close modal-event-close"><span class="x"></span></a></div></div>'}),Toolkit.createComponent("modal",function(a){return new Toolkit.Modal(this,a)},!0)}(jQuery);