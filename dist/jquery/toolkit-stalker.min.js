/*!
 * Titon Toolkit v1.0.4
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Stalker=Toolkit.Component.create(function(b,c){this.options=this.setOptions(Toolkit.Stalker.options,c),this.element=this.setElement(b,this.options),this.target=null,this.targets=[],this.marker=null,this.markers=[],this.offsets=[],this.container=null,this.enabled=!0,this.initialize=function(){this.options.target&&this.options.marker&&(this.element.addClass(Toolkit.options.vendor+"stalker"),this.container="auto"===this.element.css("overflow")?this.element:a(window),this.refresh(),this.container.on("scroll",a.throttle(this.__scroll.bind(this),this.options.throttle)),a(document).ready(this.__scroll.bind(this)),this.fireEvent("init"))},this.activate=function(b,c){this.marker=a(b),this.target=c=a(c);var d=this.targets;return this.options.applyToParent?(d.parent().removeClass(Toolkit.options.isPrefix+"active"),c.parent().addClass(Toolkit.options.isPrefix+"active")):(d.removeClass(Toolkit.options.isPrefix+"active"),c.addClass(Toolkit.options.isPrefix+"active")),this.fireEvent("activate",[b,c]),this},this.deactivate=function(a){var b=this.targets;return this.options.applyToParent?b.parent().removeClass(Toolkit.options.isPrefix+"active"):b.removeClass(Toolkit.options.isPrefix+"active"),this.marker=null,this.target=null,this.fireEvent("deactivate",a),this},this.refresh=function(){"auto"!==this.element.css("overflow")||this.element.is("body")||(this.element[0].scrollTop=0),this.target=null,this.targets=a(this.options.target),this.targets.addClass(Toolkit.options.vendor+"stalker-target"),this.marker=null,this.markers=a(this.options.marker),this.markers.addClass(Toolkit.options.vendor+"stalker-marker");var b,c=this.container.is(window),d=this.element.offset().top,e=[];return this.markers.each(function(f,g){g=a(g),b=g.offset(),c||(b.top-=d),e.push(b)}),this.offsets=e,this},this.__scroll=function(){if(this.enabled){var b=this.container.scrollTop(),c=this.markers,d=this.targets,e=this.offsets,f=this.options.onlyWithin,g=this.options.threshold;c.each(function(c,h){h=a(h);var i=e[c],j=i.top-g,k=i.top+h.height()+g,l=[];f&&b>=j&&k>=b||!f&&b>=j?(l=d.filter(function(){return a(this).attr("href")==="#"+h.attr("id")}),l.length&&this.activate(h,l.item(0))):this.marker&&this.marker.is(h)&&this.deactivate(h)}.bind(this)),this.fireEvent("scroll")}},this.element.length&&this.initialize()}),Toolkit.Stalker.options={target:"",marker:"",threshold:50,throttle:50,onlyWithin:!0,applyToParent:!0},a.fn.stalker=function(b){return this.each(function(){a(this).addData("toolkit.stalker",function(){return new Toolkit.Stalker(this,b)})})}}(jQuery);