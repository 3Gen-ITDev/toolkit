/*!
 * Titon Toolkit v1.2.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";Toolkit.Stalker=Toolkit.Component.extend(function(b,c){if(this.component="Stalker",this.version="1.2.0",this.element=b=a(b),this.options=c=this.setOptions(c),!c.target||!c.marker)throw new Error("A marker and target is required");this.targets=[],this.markers=[],this.offsets=[],this.container="auto"===b.css("overflow")?b:a(window),b.addClass(Toolkit.options.vendor+"stalker"),this.refresh(),this.events={"scroll container":a.throttle(this.onScroll.bind(this),c.throttle),"ready document":"onScroll"},this.enable(),this.fireEvent("init")},{activate:function(a){this._stalk(a,"activate")},deactivate:function(a){this._stalk(a,"deactivate")},refresh:function(){var b,c=Toolkit.options.vendor,d=this.container.is(window),e=this.element.offset().top,f=[];"auto"!==this.element.css("overflow")||this.element.is("body")||(this.element[0].scrollTop=0),this.targets=a(this.options.target).addClass(c+"stalker-target"),this.markers=a(this.options.marker).addClass(c+"stalker-marker").each(function(c,g){g=a(g),b=g.offset(),d||(b.top-=e),f.push(b)}),this.offsets=f},_stalk:function(b,c){b=a(b);var d=Toolkit.options.isPrefix;if("activate"!==c||!b.hasClass(d+"stalked")){var e=this.options,f=e.targetBy,g=e.markBy,h="activate"===c?"addClass":"removeClass",i=this.targets.filter(function(){return a(this).attr(f).replace("#","")===b.attr(g)});b[h](d+"stalked"),e.applyToParent?i.parent()[h](d+"active"):i[h](d+"active"),this.fireEvent(c,[b,i])}},onScroll:function(){var b=this.container.scrollTop(),c=this.offsets,d=this.options.onlyWithin,e=this.options.threshold;this.markers.each(function(f,g){g=a(g);var h=c[f],i=h.top-e,j=h.top+g.height()+e;d&&b>=i&&j>=b||!d&&b>=i?this.activate(g):this.deactivate(g)}.bind(this)),this.fireEvent("scroll")}},{target:"",targetBy:"href",marker:"",markBy:"id",threshold:50,throttle:50,onlyWithin:!0,applyToParent:!0}),Toolkit.createComponent("stalker",function(a){return new Toolkit.Stalker(this,a)})}(jQuery);