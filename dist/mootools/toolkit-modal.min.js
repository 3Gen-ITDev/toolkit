/*!
 * Titon Toolkit v1.1.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Modal=new Class({Extends:Toolkit.Component,Binds:["onSubmit"],blackout:null,drag:null,elementBody:null,options:{delegate:".js-modal",animation:"fade",ajax:!0,draggable:!1,blackout:!0,fullScreen:!1,stopScroll:!0,getContent:"data-modal",contentElement:".modal-inner",closeElement:".modal-close",closeEvent:".modal-event-close",submitEvent:".modal-event-submit",template:'<div class="modal"><div class="modal-outer"><div class="modal-handle"><div class="modal-inner"></div><button type="button" class="modal-close modal-event-close"><span class="x"></span></button></div></div></div>'},initialize:function(a,b){this.parent(b),this.nodes=a,this.createElement(),b=this.options,b.fullScreen&&(this.element.addClass(Toolkit.options.isPrefix+"fullscreen"),b.draggable=!1),this.elementBody=this.element.getElement(b.contentElement),b.blackout&&(this.blackout=Toolkit.Blackout.factory(),b.stopScroll&&this.blackout.addEvent("hide",function(a){a&&document.body.removeClass("no-scroll")}));var c={};c["clickout element"]="onHide",c["clickout nodes"]="onHide",c["keydown window"]="onKeydown",c["click "+b.delegate]="onShow",c["click element "+b.closeEvent]="onHide",c["click element "+b.submitEvent]="onSubmit",this.events=c,this.enable(),this.fireEvent("init")},hide:function(){return this.blackout&&this.blackout.hide(),this.parent()},position:function(a){return a===!0?this:(this.blackout&&this.blackout.hideLoader(),this.elementBody.set("html",a),this.fireEvent("load",a),this.element.reveal(),this.options.fullScreen&&this.element.getElement(this.options.contentElement).setStyle("min-height",window.getHeight()),this.fireEvent("show"),this)},show:function(a,b){var c=this.options,d=c.ajax;return b?d=!1:a&&(this.node=a,d=this.readOption(a,"ajax"),b=this.readValue(a,this.readOption(a,"getContent"))||a.get("href"),b&&b.match(/^#[a-z0-9_\-\.:]+$/i)&&(d=!1)),b?(this.blackout&&this.blackout.show(),c.stopScroll&&document.body.addClass("no-scroll"),d?this.cache[b]?this.position(this.cache[b]):this.requestData(b):this.position(b),this):this},onKeydown:function(a){"esc"===a.key&&this.element.isShown()&&this.hide()},onSubmit:function(a){a.preventDefault();var b=a.target,c=this.elementBody.getElement("form");if(c){this.fireEvent("submit",[b,c]);var d={url:c.get("action"),method:c.get("method").toUpperCase()};d.data=window.FormData?new FormData(c):c.toQueryString(),this.requestData(d)}}}),Toolkit.createComponent("modal",function(a){return new Toolkit.Modal(this,a)},!0)}();