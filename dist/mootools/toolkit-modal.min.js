/*!
 * Titon Toolkit v1.0.0
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Modal=new Class({Extends:Toolkit.Component,Binds:["__submit"],blackout:null,drag:null,elementBody:null,options:{delegate:".js-modal",animation:"fade",ajax:!0,draggable:!1,blackout:!0,showLoading:!0,fullScreen:!1,getContent:"data-modal",contentElement:".modal-inner",closeElement:".modal-close",closeEvent:".modal-event-close",submitEvent:".modal-event-submit",template:'<div class="modal"><div class="modal-handle"><div class="modal-inner"></div><a href="javascript:;" class="modal-close modal-event-close"><span class="x"></span></a></div></div>',onSubmit:null},initialize:function(a,b){this.parent(b),this.setNodes(a),this.createElement(),this.options.fullScreen&&(this.element.addClass("is-fullscreen"),this.options.draggable=!1),this.elementBody=this.element.getElement(this.options.contentElement),this.options.draggable&&(this.drag=new Drag(this.element,{onStart:function(a){a.addClass("is-dragging")},onComplete:function(a){a.removeClass("is-dragging")}}),this.element.addClass("is-draggable")),this.options.blackout&&(this.blackout=new Toolkit.Blackout,this.blackout.element.addEvent("click",this.__hide)),this.bindEvents(),this.fireEvent("init")},bindEvents:function(){return this.parent(),window.addEvent("keydown",function(a){"esc"===a.key&&this.isVisible()&&this.hide()}.bind(this)),this.element.addEvent("click:relay("+this.options.closeEvent+")",this.__hide).addEvent("click:relay("+this.options.submitEvent+")",this.__submit),this},hide:function(){return this.parent(function(){this.options.blackout&&this.blackout.hide()}.bind(this))},position:function(a){if(a===!0)return this;if(this.elementBody.set("html",a),this.fireEvent("load",a),!this.isVisible()&&(this.options.blackout&&this.blackout.show(),this.options.fullScreen&&this.element.getElement(this.options.contentElement).setStyle("min-height",window.getHeight()),this.element.reveal(),Browser.ie8&&!this.options.fullScreen)){var b=this.element.getSize();this.element.setStyles({"margin-left":-(b.x/2),"margin-top":-(b.y/2)})}return this.fireEvent("show"),this},show:function(a,b){var c=this.options;return b?c.ajax=!1:a&&(b=a.get("href")||this.readValue(a,c.getContent),"#"===b.substr(0,1)&&(c.ajax=!1)),b?(this.node=a,c.ajax?this.cache[b]?this.position(this.cache[b]):this.requestData(b):this.position(b),this):this},__submit:function(a){a.stop();var b=a.target,c=this.elementBody.getElement("form");c&&(this.fireEvent("submit",b),new Request({url:c.get("action"),method:c.get("method").toUpperCase(),data:c.toQueryString(),evalScripts:!0,onSuccess:function(a){this.position(a)}.bind(this),onFailure:function(){this.position(this._errorTemplate())}.bind(this)}).send())}}),Elements.implement("modal",function(a){var b=new Toolkit.Modal(this,a);return this.each(function(a){a.$modal||(a.$modal=b)})})}();