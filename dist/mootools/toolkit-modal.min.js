/*!
 * Titon Toolkit v1.1.0-rc.1
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Modal=new Class({Extends:Toolkit.Component,Binds:["__submit"],blackout:null,drag:null,elementBody:null,options:{delegate:".js-modal",animation:"fade",ajax:!0,draggable:!1,blackout:!0,fullScreen:!1,stopScroll:!0,getContent:"data-modal",contentElement:".modal-inner",closeElement:".modal-close",closeEvent:".modal-event-close",submitEvent:".modal-event-submit",template:'<div class="modal"><div class="modal-handle"><div class="modal-inner"></div><a href="javascript:;" class="modal-close modal-event-close"><span class="x"></span></a></div></div>',onSubmit:null},initialize:function(a,b){this.parent(b),this.setNodes(a),this.createElement(),this.options.fullScreen&&(this.element.addClass(Toolkit.options.isPrefix+"fullscreen"),this.options.draggable=!1),this.elementBody=this.element.getElement(this.options.contentElement),this.options.draggable&&(this.drag=new Drag(this.element,{onStart:function(a){a.addClass(Toolkit.options.isPrefix+"dragging")},onComplete:function(a){a.removeClass(Toolkit.options.isPrefix+"dragging")}}),this.element.addClass(Toolkit.options.isPrefix+"draggable")),this.options.blackout&&(this.blackout=Toolkit.Blackout.factory(),this.options.stopScroll&&this.blackout.addEvent("hide",function(a){a&&document.body.setStyle("overflow","")})),this.bindEvents(),this.fireEvent("init")},bindEvents:function(){return this.parent(),window.addEvent("keydown",function(a){"esc"===a.key&&this.isVisible()&&this.hide()}.bind(this)),this.element.addEvent("clickout",this.__hide).addEvent("click:relay("+this.options.closeEvent+")",this.__hide).addEvent("click:relay("+this.options.submitEvent+")",this.__submit),this.nodes.addEvent("clickout",this.__hide),this},hide:function(){return this.blackout&&this.blackout.hide(),this.parent()},position:function(a){if(a===!0)return this;if(this.elementBody.set("html",a),this.fireEvent("load",a),this.blackout&&this.blackout.hideLoader(),this.element.reveal(),this.options.fullScreen)this.element.getElement(this.options.contentElement).setStyle("min-height",window.getHeight());else if(!Toolkit.hasTransform){var b=this.element.getSize();this.element.setStyles({"margin-left":-(b.x/2),"margin-top":-(b.y/2)})}return this.fireEvent("show"),this},show:function(a,b){var c=this.options,d=c.ajax;return b?d=!1:a&&(b=this.readValue(a,c.getContent)||a.get("href"),b&&b.match(/^#[a-z0-9_\-\.:]+$/i)&&(d=!1)),b?(this.node=a,this.blackout&&this.blackout.show(),c.stopScroll&&document.body.setStyle("overflow","hidden"),d?this.cache[b]?this.position(this.cache[b]):this.requestData(b):this.position(b),this):this},__submit:function(a){a.preventDefault();var b=a.target,c=this.elementBody.getElement("form");if(c){this.fireEvent("submit",[b,c]);var d={url:c.get("action"),method:c.get("method").toUpperCase()};d.data=window.FormData?new FormData(c):c.toQueryString(),this.requestData(d)}}}),Toolkit.createComponent("modal",function(a){return new Toolkit.Modal(this,a)},!0)}();