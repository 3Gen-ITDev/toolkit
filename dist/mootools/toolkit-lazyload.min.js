/*!
 * Titon Toolkit v1.0.0
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.LazyLoad=new Class({Extends:Toolkit.Component,Binds:["load","loadAll"],isLoaded:!1,loaded:0,options:{lazyClass:".lazy-load",forceLoad:!1,delay:1e4,threshold:150,throttle:50,context:null,onLoad:null,onLoadAll:null,onShow:null,onShutdown:null},initialize:function(a,b){this.parent(b),this.setElement(a),this.element.length&&(document.id(this.options.context||window).addEvent("scroll:throttle("+this.options.throttle+")",this.load).addEvent("resize:throttle("+this.options.throttle+")",this.load),window.addEvent("domready",function(){this.load(),this.options.forceLoad&&window.setTimeout(this.loadAll,this.options.delay)}.bind(this)),this.fireEvent("init"))},inViewport:function(a){var b=this.options.threshold,c=window.getScroll(),d=window.getSize(),e=a.getPosition();return e.y>=c.y-b&&e.y<=c.y+d.y+b&&e.x>=c.x-b&&e.x<=c.x+d.x+b},load:function(){return this.isLoaded?!1:this.loaded===this.element.length?(this.shutdown(),!1):(this.element.each(function(a,b){a&&this.inViewport(a)&&this.show(a,b)},this),this.fireEvent("load"),!0)},loadAll:function(){return this.isLoaded?!1:(this.element.each(function(a,b){a&&this.show(a,b)},this),this.fireEvent("loadAll"),this.shutdown(),!0)},show:function(a,b){return a.removeClass(this.options.lazyClass.substr(1)),a.getElements("img").each(function(a){var b=a.get("data-lazyload");b&&a.set("src",b)}),this.element.splice(b,1,null),this.loaded++,this.fireEvent("show",a),this},shutdown:function(){return this.isLoaded=!0,document.id(this.options.context||window).removeEvents({scroll:this.load,resize:this.load}),this.fireEvent("shutdown"),this}}),Elements.implement("lazyLoad",function(a){var b=new Toolkit.LazyLoad(this,a);return this.each(function(a){a.$lazyLoad||(a.$lazyLoad=b)})})}();