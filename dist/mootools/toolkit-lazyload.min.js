/*!
 * Titon Toolkit v1.2.2
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.LazyLoad=new Class({Extends:Toolkit.Component,Binds:["load","loadAll"],container:null,elements:[],isLoaded:!1,loaded:0,options:{lazyClass:".lazy-load",forceLoad:!1,delay:1e4,threshold:150,throttle:50,context:null},initialize:function(a,b){this.parent(b),this.options=this.inheritOptions(this.options,a),this.container="auto"===a.getStyle("overflow")?a:window,this.elements=a.getElements(".lazy-load");var c,d=this.options.throttle;this.events=c={"ready document":"onReady"},c["scroll:throttle("+d+") container"]="load",c["resize:throttle("+d+") window"]="load",this.enable(),this.fireEvent("init")},inViewport:function(a){var b=this.container,c=this.options.threshold,d=b.getSize(),e=b.getScroll(),f=a.getPosition(b===window?document.body:b);return a.isVisible()&&f.y>=e.y-c&&f.y<=e.y+d.y+c&&f.x>=e.x-c&&f.x<=e.x+d.x+c},load:function(){return this.isLoaded?!1:this.loaded===this.elements.length?(this.shutdown(),!1):(this.elements.each(function(a,b){a&&this.inViewport(a)&&this.show(a,b)},this),this.fireEvent("load"),!0)},loadAll:function(){return this.isLoaded?!1:(this.elements.each(function(a,b){a&&this.show(a,b)},this),this.fireEvent("loadAll"),this.shutdown(),!0)},show:function(a,b){return a.removeClass("lazy-load"),a.getElements("img").each(function(a){var b;Toolkit.isRetina&&(b=a.get("data-src-retina")),b||(b=a.get("data-src")),b&&a.set("src",b)}),this.elements.splice(b,1,null),this.loaded++,this.fireEvent("show",a),this},shutdown:function(){return this.isLoaded=!0,this.disable(),this.fireEvent("shutdown"),this},onReady:function(){this.load(),this.options.forceLoad&&setTimeout(this.loadAll.bind(this),this.options.delay)}}),Toolkit.createComponent("lazyLoad",function(a){return new Toolkit.LazyLoad(this,a)})}();