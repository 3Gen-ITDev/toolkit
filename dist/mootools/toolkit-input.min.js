/*!
 * Titon Toolkit v1.1.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Input=new Class({Extends:Toolkit.Component,wrapper:null,input:null,options:{checkbox:'input[type="checkbox"]',radio:'input[type="radio"]',select:"select",copyClasses:!0},initialize:function(a,b){this.parent(b),this.setElement(a),this.element&&(this.bindEvents(),this.fireEvent("init"))},bindEvents:function(){var a=this.options;return a.checkbox&&this.element.getElements(a.checkbox).inputCheckbox(a),a.radio&&this.element.getElements(a.radio).inputRadio(a),a.select&&this.element.getElements(a.select).inputSelect(a),this},buildWrapper:function(a){return this.wrapper=new Element("div."+Toolkit.options.vendor+"custom-input").wraps(a),this.options.copyClasses&&this.copyClasses(a,this.wrapper),this},copyClasses:function(a,b){var c=(a.get("class")||"").replace(/\binput\b/,"").trim();return c&&b.addClass(c),this}}),Toolkit.Input.Checkbox=new Class({Extends:Toolkit.Input,initialize:function(a,b){this.input=a,this.setOptions(b),this.buildWrapper(a),this.setElement(new Element("label."+Toolkit.options.vendor+"checkbox").setProperty("for",a.get("id")).inject(a,"after")),this.fireEvent("init")}}),Toolkit.Input.Radio=new Class({Extends:Toolkit.Input,initialize:function(a,b){this.input=a,this.setOptions(b),this.buildWrapper(a),this.setElement(new Element("label."+Toolkit.options.vendor+"radio").setProperty("for",a.get("id")).inject(a,"after")),this.fireEvent("init")}}),Toolkit.Input.Select=new Class({Extends:Toolkit.Input,Binds:["buildOption","onChange","onCycle","onToggle"],dropdown:null,multiple:!1,index:0,options:{"native":!1,multipleFormat:"count",countMessage:"{count} of {total} selected",listLimit:3,hideFirst:!1,hideSelected:!1,arrowContent:'<span class="caret-down"></span>',getDefaultLabel:"title",getOptionLabel:"title",getDescription:"data-description"},initialize:function(a,b){this.input=a,this.setOptions(b),this.multiple=a.multiple,a.multiple&&this.options.native||(this.buildWrapper(a),this.buildButton(a),this.options.native||(this.buildDropdown(a),a.setStyle("z-index",1).addEvent("blur",this.onHide)),this.bindEvents(),this.fireEvent("init"))},bindEvents:function(){return this.input.addEvent("change",this.onChange),this.options.native||(this.dropdown.addEvent("clickout",this.onHide),this.element.addEvent("clickout",this.onHide).addEvent("click",this.onToggle)),this.multiple||window.addEvent("keydown",this.onCycle),this.input.fireEvent("change",{target:this.input}),this},buildButton:function(a){var b=Toolkit.options.vendor;return this.element=new Element("div."+b+"select").grab(new Element("div."+b+"select-arrow").set("html",this.options.arrowContent)).grab(new Element("div."+b+"select-label").set("text",Toolkit.messages.loading)).setStyle("min-width",a.getWidth()).inject(a,"after"),this.multiple&&this.input.setStyle("max-height",this.element.getHeight()),this},buildDropdown:function(a){var b=Toolkit.options.vendor,c=this.options,d=this.buildOption,e=new Element("div."+b+"drop--down."+b+"select-options"),f=new Element("ul"),g=0;return this.dropdown=e,Array.from(a.children).each(function(a){"optgroup"===a.get("tag")?(0===g&&(c.hideFirst=!1),f.grab(new Element("li").addClass(b+"drop-heading").set("text",a.get("label"))),Array.from(a.children).each(function(b){a.disabled&&(b.disabled=!0),b.selected&&(this.index=g),f.grab(d(b,g)),g++},this)):(a.selected&&(this.index=g),f.grab(d(a,g)),g++)},this),c.hideSelected&&!c.multiple&&e.addClass("hide-selected"),c.hideFirst&&e.addClass("hide-first"),a.multiple&&e.addClass(Toolkit.options.isPrefix+"multiple"),this.wrapper.grab(e.grab(f)),this},buildOption:function(a,b){var c,d=this.input,e=this.dropdown,f=Toolkit.options.isPrefix+"active",g=new Element("li"),h=a.textContent;a.selected&&g.addClass(f),(c=this.readValue(a,this.options.getDescription))&&(h+=' <span class="'+Toolkit.options.vendor+'drop-desc">'+c+"</span>");var i=new Element("a").set("html",h).set("href","javascript:;");if(this.options.copyClasses&&this.copyClasses(a,g),g.grab(i),a.disabled)return g.addClass(Toolkit.options.isPrefix+"disabled"),g;if(this.multiple)i.addEvent("click",function(){a.selected?(a.selected=!1,this.getParent().removeClass(f)):(a.selected=!0,this.getParent().addClass(f)),d.fireEvent("change",{target:d})});else{var j=this;i.addEvent("click",function(){e.getElements("li").removeClass(f),this.getParent().addClass(f),j.hide(),j.index=b,d.set("value",a.value),d.fireEvent("change",{target:d})})}return g},hide:function(){return this.element.removeClass(Toolkit.options.isPrefix+"active"),this.dropdown&&this.dropdown.conceal(),this.fireEvent("hide"),this},show:function(){return this.element.addClass(Toolkit.options.isPrefix+"active"),this.dropdown&&this.dropdown.reveal(),this.fireEvent("show"),this},_loop:function(a,b,c){var d=this.options.hideFirst;for(a+=b;"undefined"==typeof c[a]||c[a].disabled||0===a&&d;)a+=b,a>=c.length?a=0:0>a&&(a=c.length-1);return a},onChange:function(a){var b=a.target,c=b.getElements("option"),d=[],e=[];if(c.each(function(a){a.selected&&(d.push(a),e.push(this.readValue(a,this.options.getOptionLabel)||a.textContent))},this),this.multiple){var f=this.readValue(b,this.options.getDefaultLabel),g=this.options.multipleFormat,h=e.length;if(!e.length&&f)e=f;else if("count"===g)e=this.options.countMessage.replace("{count}",h).replace("{total}",c.length);else if("list"===g){var i=this.options.listLimit;e=e.splice(0,i).join(", "),h>i&&(e+=" ...")}}else e=e.join(", ");b.getParent().getElement("."+Toolkit.options.vendor+"select-label").set("text",e),this.fireEvent("change",[b.get("value"),d])},onCycle:function(a){if(this.dropdown.isVisible()&&["up","down","enter","esc"].contains(a.key)){a.preventDefault();var b=this.input.getElements("option"),c=this.dropdown.getElements("a"),d=Toolkit.options.isPrefix+"active",e=this.index;switch(a.key){case"enter":case"esc":return void this.hide();case"up":e=this._loop(e,-1,b);break;case"down":e=this._loop(e,1,b)}b.set("selected",!1),b[e].selected=!0,c.getParent().removeClass(d),c[e].getParent().addClass(d),this.index=e,this.input.fireEvent("change",{target:this.input})}},onToggle:function(){this.enabled&&!this.input.disabled&&(this.dropdown.isShown()?this.hide():this.show())}}),Toolkit.createComponent("input",function(a){return new Toolkit.Input(this,a)}),Toolkit.createComponent("inputRadio",function(a){return new Toolkit.Input.Radio(this,a)}),Toolkit.createComponent("inputCheckbox",function(a){return new Toolkit.Input.Checkbox(this,a)}),Toolkit.createComponent("inputSelect",function(a){return new Toolkit.Input.Select(this,a)})}();