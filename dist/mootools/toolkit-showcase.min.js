/*!
 * Titon Toolkit v1.1.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Showcase=new Class({Extends:Toolkit.Component,Binds:["next","prev","onJump"],items:null,tabs:null,prevButton:null,nextButton:null,data:[],index:0,blackout:null,options:{delegate:".js-showcase",blackout:!0,stopScroll:!0,transition:300,gutter:50,getCategory:"data-showcase",getImage:"href",getTitle:"title",itemsElement:".showcase-items",tabsElement:".showcase-tabs",prevElement:".showcase-prev",nextElement:".showcase-next",closeEvent:".showcase-event-close",jumpEvent:".showcase-event-jump",prevEvent:".showcase-event-prev",nextEvent:".showcase-event-next",template:'<div class="showcase"><div class="showcase-inner"><ul class="showcase-items"></ul><ol class="showcase-tabs bullets"></ol><button type="button" class="showcase-prev showcase-event-prev"><span class="arrow-left"></span></button><button type="button" class="showcase-next showcase-event-next"><span class="arrow-right"></span></button><button type="button" class="showcase-close showcase-event-close"><span class="x"></span></button></div></div>'},initialize:function(a,b){this.parent(b),this.setNodes(a),this.createElement(),Toolkit.hasTransition||(this.options.transition=1),b=this.options,this.items=this.element.getElement(b.itemsElement),this.tabs=this.element.getElement(b.tabsElement),this.prevButton=this.element.getElement(b.prevElement),this.nextButton=this.element.getElement(b.nextElement),b.gutter+=this.element.getHeight()-this.items.getHeight(),this.options.blackout&&(this.blackout=Toolkit.Blackout.factory()),this.bindEvents(),this.fireEvent("init")},bindEvents:function(){return this.parent(),window.addEvent("keydown",function(a){if(this.isVisible())switch(["up","down","left","right"].contains(a.key)&&a.preventDefault(),a.key){case"esc":this.hide();break;case"up":this.jump(0);break;case"down":this.jump(-1);break;case"left":this.prev();break;case"right":this.next()}}.bind(this)),this.element.addEvent("clickout",this.onHide).addEvent("click:relay("+this.options.closeEvent+")",this.onHide).addEvent("click:relay("+this.options.nextEvent+")",this.next).addEvent("click:relay("+this.options.prevEvent+")",this.prev).addEvent("click:relay("+this.options.jumpEvent+")",this.onJump).addEvent("swipe",function(a){"left"===a.direction?this.next():"right"===a.direction&&this.prev()}.bind(this)),this.nodes.addEvent("clickout",this.onHide),this},hide:function(){return this.blackout&&this.blackout.hide(),this.options.stopScroll&&document.body.removeClass("no-scroll"),this.parent(function(){this.element.removeClass(Toolkit.options.isPrefix+"single"),this.items.removeProperty("style").getElements("li").removeClass("show")}.bind(this)),this},jump:function(a){a>=this.data.length?a=0:0>a&&(a=this.data.length-1);var b=this,c=this.options,d=this.element,e=this.items,f=e.getElements("li"),g=f[a],h=this.data,i=h[a];if(this.index=a,this.tabs){var j=this.tabs.getElements("a");j.removeClass(Toolkit.options.isPrefix+"active"),j[a].addClass(Toolkit.options.isPrefix+"active")}if(f.removeClass("show"),g.hasAttribute("data-width"))this._resize(g.get("data-width").toInt(),g.get("data-height").toInt()),setTimeout(function(){g.addClass("show"),b.position()},c.transition);else{d.addClass(Toolkit.options.isPrefix+"loading");var k=new Image;k.src=i.image,k.onload=function(){b._resize(this.width,this.height),g.set("data-width",this.width).set("data-height",this.height),i.title&&g.grab(new Element("div."+Toolkit.options.vendor+"showcase-caption").set("html",i.title)),setTimeout(function(){d.removeClass(Toolkit.options.isPrefix+"loading"),g.addClass("show").grab(k),b.position()},c.transition)}}return this.fireEvent("jump",a),this},next:function(){return this.jump(this.index+1),this},position:function(){return this.blackout&&this.blackout.hideLoader(),this.element.reveal(),this.fireEvent("show"),this},prev:function(){return this.jump(this.index-1),this},show:function(a){this.node=a,this.index=0,this.element.addClass(Toolkit.options.isPrefix+"loading");var b=this.options,c=this.readValue,d=c(a,b.getCategory),e=[],f=0;if(d)for(var g,h=0,i=0;g=this.nodes[h];h++)c(g,b.getCategory)===d&&(g===a&&(f=i),e.push({title:c(g,b.getTitle),category:d,image:c(g,b.getImage)}),i++);else e.push({title:c(a,b.getTitle),category:d,image:c(a,b.getImage)});return this.blackout&&this.blackout.show(),b.stopScroll&&document.body.addClass("no-scroll"),this._buildItems(e),this.jump(f),this},_buildItems:function(a){this.data=a,this.items.empty(),this.tabs.empty();for(var b,c,d,e=0;d=a[e];e++)b=new Element("li"),b.inject(this.items),c=new Element("a").set("class",this.options.jumpEvent.substr(1)).set("href","javascript:;").set("data-index",e),b=new Element("li"),b.inject(this.tabs).grab(c);return a.length<=1&&this.element.addClass(Toolkit.options.isPrefix+"single"),this.fireEvent("load",a),this}.protect(),_resize:function(a,b){var c,d,e=window.getSize(),f=this.options.gutter;if(a+f>e.x){var g=e.x-2*f;c=a/b,d=a-g,a=g,b-=Math.round(d/c)}else if(b+f>e.y){var h=e.y-2*f;c=b/a,d=b-h,a-=Math.round(d/c),b=h}return this.items.setStyles({width:a,height:b}),this},onJump:function(a){a.preventDefault(),this.jump(a.target.get("data-index")||0)}}),Toolkit.createComponent("showcase",function(a){return new Toolkit.Showcase(this,a)},!0)}();