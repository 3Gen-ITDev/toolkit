/*!
 * Titon Toolkit v1.0.0-rc.3
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Showcase=new Class({Extends:Toolkit.Component,Binds:["next","prev","__jump"],items:null,tabs:null,prevButton:null,nextButton:null,data:[],previousIndex:0,currentIndex:0,blackout:null,options:{delegate:".js-showcase",blackout:!0,transition:300,gutter:50,getCategory:"data-showcase",getImage:"href",getTitle:"title",itemsElement:".showcase-items",tabsElement:".showcase-tabs",prevElement:".showcase-prev",nextElement:".showcase-next",closeEvent:".showcase-event-close",jumpEvent:".showcase-event-jump",prevEvent:".showcase-event-prev",nextEvent:".showcase-event-next",template:'<div class="showcase"><div class="showcase-inner"><ul class="showcase-items"></ul><ol class="showcase-tabs bullets"></ol><a href="javascript:;" class="showcase-prev showcase-event-prev"><span class="arrow-left"></span></a><a href="javascript:;" class="showcase-next showcase-event-next"><span class="arrow-right"></span></a><a href="javascript:;" class="showcase-close showcase-event-close"><span class="x"></span></a></div></div>',onJump:null},initialize:function(a,b){this.parent(b),this.setNodes(a),this.createElement(),(Browser.ie8||Browser.ie9)&&(this.options.transition=1),b=this.options,this.items=this.element.getElement(b.itemsElement),this.tabs=this.element.getElement(b.tabsElement),this.prevButton=this.element.getElement(b.prevElement),this.nextButton=this.element.getElement(b.nextElement),this.options.blackout&&(this.blackout=new Toolkit.Blackout,this.blackout.element.addEvent("click",this.__hide)),this.bindEvents(),this.fireEvent("init")},bindEvents:function(){return this.parent(),window.addEvent("keydown",function(a){if(this.isVisible())switch(["up","down","left","right"].contains(a.key)&&a.preventDefault(),a.key){case"esc":this.hide();break;case"up":this.jump(0);break;case"down":this.jump(-1);break;case"left":this.prev();break;case"right":this.next()}}.bind(this)),this.element.addEvent("click:relay("+this.options.closeEvent+")",this.__hide).addEvent("click:relay("+this.options.nextEvent+")",this.next).addEvent("click:relay("+this.options.prevEvent+")",this.prev).addEvent("click:relay("+this.options.jumpEvent+")",this.__jump).addEvent("swipe",function(a){"left"===a.direction&&this.next()}.bind(this)).addEvent("swipe",function(a){"right"===a.direction&&this.prev()}.bind(this)),this},hide:function(){return this.parent(function(){this.options.blackout&&this.blackout.hide(),this.element.removeClass("is-single"),this.items.removeProperty("style").getElements("li").removeClass("show")}.bind(this)),this},jump:function(a){a>=this.data.length?a=0:0>a&&(a=this.data.length-1);var b=this,c=this.options,d=this.element,e=this.items,f=e.getElements("li"),g=f[a],h=this.data,i=h[a];if(this.previousIndex=this.currentIndex,this.currentIndex=a,this.tabs){var j=this.tabs.getElements("a");j.removeClass("is-active"),j[a].addClass("is-active")}if(f.removeClass("show"),g.hasAttribute("data-width"))this._resize(g.get("data-width").toInt(),g.get("data-height").toInt()),setTimeout(function(){g.addClass("show"),b._reposition()},c.transition);else{d.addClass("is-loading");var k=new Image;k.src=i.image,k.onload=function(){b._resize(this.width,this.height),g.set("data-width",this.width).set("data-height",this.height),i.title&&g.grab(new Element("div.showcase-caption").set("html",i.title)),setTimeout(function(){d.removeClass("is-loading"),g.addClass("show").grab(k),b._reposition()},c.transition)}}return this.fireEvent("jump",a),this},next:function(){return this.jump(this.currentIndex+1),this},position:function(){return this.isVisible()||(this.options.blackout&&this.blackout.show(),this.element.reveal(),this._reposition()),this.fireEvent("show"),this},prev:function(){return this.jump(this.currentIndex-1),this},show:function(a){this.node=a,this.currentIndex=this.previousIndex=0,this.element.addClass("is-loading");var b=this.options,c=this.readValue,d=c(a,b.getCategory),e=[],f=0;if(d)for(var g,h=0,i=0;g=this.nodes[h];h++)c(g,b.getCategory)===d&&(g===a&&(f=i),e.push({title:c(g,b.getTitle),category:d,image:c(g,b.getImage)}),i++);else e.push({title:c(a,b.getTitle),category:d,image:c(a,b.getImage)});return this._buildItems(e),this.position(),this.jump(f),this},_buildItems:function(a){this.data=a,this.items.empty(),this.tabs.empty();for(var b,c,d,e=0;d=a[e];e++)b=new Element("li"),b.inject(this.items),c=new Element("a").set("class",this.options.jumpEvent.substr(1)).set("href","javascript:;").set("data-index",e),b=new Element("li"),b.inject(this.tabs).grab(c);return a.length<=1&&this.element.addClass("is-single"),this.fireEvent("load",a),this}.protect(),_reposition:function(){if(!Browser.ie8)return this;var a=this.element.getSize();return this.element.setStyles({"margin-left":-(a.x/2),"margin-top":-(a.y/2)}),this},_resize:function(a,b){var c,d,e=window.getSize();if(a>e.x){var f=e.x-2*this.options.gutter;c=a/b,d=a-f,a=f,b-=Math.round(d/c)}else if(b>e.y){var g=e.y-2*this.options.gutter;c=b/a,d=b-g,a-=Math.round(d/c),b=g}return this.items.setStyles({width:a,height:b}),this},__jump:function(a){a.stop(),this.jump(a.target.get("data-index")||0)}}),Elements.implement("showcase",function(a){var b=new Toolkit.Showcase(this,a);return this.each(function(a){a.$showcase||(a.$showcase=b)})})}();