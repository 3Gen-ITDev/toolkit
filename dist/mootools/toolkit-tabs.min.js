/*!
 * Titon Toolkit v1.0.1
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Tabs=new Class({Extends:Toolkit.Component,nav:null,sections:[],tabs:[],previousIndex:0,currentIndex:0,options:{ajax:!0,collapsible:!1,defaultIndex:0,persistState:!1,preventDefault:!0,loadFragment:!0,cookie:null,cookieDuration:30,getUrl:"href",navElement:".tabs-nav",sectionsElement:".tabs-section",template:!1},initialize:function(a,b){if(this.parent(b),this.setElement(a),this.element){this.options.cookie||(this.options.cookie=this.element.get("id")),b=this.options,this.nav=this.element.getElement(b.navElement),this.tabs=this.nav.getElements("ul > li > a"),this.tabs.each(function(a,b){a.set("data-index",b).removeClass(Toolkit.options.isPrefix+"active")}),this.sections=this.element.getElements(b.sectionsElement),this.sections.conceal(),this.bindEvents(),this.fireEvent("init");var c=b.defaultIndex;if(b.persistState)c=Number.from(Cookie.read("toolkit.tabs."+b.cookie)||b.defaultIndex);else if(b.loadFragment&&location.hash){var d=this.tabs.filter(function(a){return a.get("href")===location.hash});d[0]&&(c=d[0].get("data-index"))}this.tabs[c]||(c=0),this.jump(c)}},bindEvents:function(){return this.tabs.addEvent("click"===this.options.mode?"click":"mouseover",this.__show),"hover"===this.options.mode&&this.options.preventDefault&&this.tabs.addEvent("click",function(a){a.preventDefault()}),this},hide:function(){return this.sections.conceal(),this.fireEvent("hide",this.node),this},jump:function(a){return this.tabs[a]&&this.show(this.tabs[a]),this},show:function(a){var b=a.get("data-index"),c=this.sections[b],d=this.readValue(a,this.options.getUrl);return this.options.ajax&&d&&"#"!==d.substr(0,1)&&!this.cache[d]&&this.requestData(d,function(){c.set("html",this._loadingTemplate()).addClass(Toolkit.options.isPrefix+"loading")}.bind(this),function(a){this.cache[d]=!0,c.set("html",a).removeClass(Toolkit.options.isPrefix+"loading"),this.fireEvent("load",a)}.bind(this),function(){c.set("html",this._errorTemplate()).removeClass(Toolkit.options.isPrefix+"loading").addClass(Toolkit.options.hasPrefix+"failed")}.bind(this)),this.nav.getElements("ul > li").removeClass(Toolkit.options.isPrefix+"active"),b===this.currentIndex&&this.options.collapsible?c.isVisible()?c.conceal():(a.getParent().addClass(Toolkit.options.isPrefix+"active"),c.reveal()):(this.hide(),a.getParent().addClass(Toolkit.options.isPrefix+"active"),c.reveal()),this.options.persistState&&Cookie.write("toolkit.tabs."+this.options.cookie,b,{duration:this.options.cookieDuration}),this.previousIndex=this.currentIndex,this.currentIndex=b,this.fireEvent("show",a),this.node=a,this},__show:function(a){(this.options.preventDefault||this.options.ajax&&"#"!==a.target.get("href").substr(0,1))&&a.preventDefault(),this.enabled&&this.show(a.target)}}),Element.implement("tabs",function(a){return this.$tabs||(this.$tabs=new Toolkit.Tabs(this,a)),this})}();