/*!
 * Titon Toolkit v1.1.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(a){"use strict";a.Toolkit={version:"1.1.0",build:"hspby6b2",options:{vendor:"",isPrefix:"is-",hasPrefix:"has-"},messages:{loading:"Loading...",error:"An error has occurred!"},hasTransition:function(){for(var a="transition WebkitTransition MozTransition OTransition msTransition".split(" "),b=document.createElement("div").style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1}(),isTouch:!!("ontouchstart"in a||a.DocumentTouch&&document instanceof DocumentTouch),isRetina:a.devicePixelRatio>1,autobox:function(a){return a="null"===typeOf(a)?null:"true"===a?!0:"false"===a?!1:isNaN(a)?String.from(a):Number.from(a)},createComponent:function(a,b,c){var d=a,e="$"+d;c?(Elements.prototype[d]&&(d="toolkit"+d.charAt(0).toUpperCase()+d.slice(1)),Elements.implement(d,function(){var a=b.apply(this,arguments);return this.each(function(b){b[e]||(b[e]=a)})})):(Element.prototype[d]&&(d="toolkit"+d.charAt(0).toUpperCase()+d.slice(1)),Element.implement(d,function(){return this[e]||(this[e]=b.apply(this,arguments)),this}))}},Element.implement({toolkit:function(a){return this["$"+a]||null},reveal:function(){return this.swapClass("hide","show")},conceal:function(){return this.swapClass("show","hide")},isShown:function(){return"hidden"!==this.getStyle("visibility")},positionTo:function(b,c,d,e){var f=d||{left:0,top:0},g=0,h=0,i=this.getDimensions({computeSize:!0,styles:["padding","border","margin"]});if("domevent"===typeOf(c))f.left+=c.page.x,f.top+=c.page.y;else{var j=c.getPosition(),k=b,l=a.getSize(),m=a.getScroll().top;f.left+=j.x,f.top+=j.y,g=c.getHeight(),h=c.getWidth(),j.top-i.totalHeight-m<0?k=k.replace("top","bottom"):j.top+g+i.totalHeight>l.y&&(k=k.replace("bottom","top")),j.left-i.totalWidth<0?k=k.replace("left","right"):j.left+h+i.totalWidth>l.x&&(k=k.replace("right","left")),b!==k&&(this.removeClass(b).addClass(k).set("data-new-position",k),b=k)}var n=b.split("-"),o={y:n[0],x:n[1]};return"top"===o.y?f.top-=i.totalHeight:"bottom"===o.y?f.top+=g:"center"===o.y&&(f.top-=Math.round(i.totalHeight/2-g/2)),"left"===o.x?f.left-=i.totalWidth:"right"===o.x?f.left+=h:"center"===o.x&&(f.left-=Math.round(i.totalWidth/2-h/2)),e&&("center"===o.y&&("left"===o.x?f.left-=15:"right"===o.x&&(f.left+=15)),"center"===o.x&&("top"===o.y?f.top-=10:"bottom"===o.y&&(f.top+=20))),this.setStyles(f)}}),Elements.implement({toolkit:function(a){var b="$"+a,c=[];return this.each(function(a){a[b]&&c.push(a[b])}),1===c.length&&c[0]?c[0]:c}}),Array.implement({chunk:function(a){var b=this;return[].concat.apply([],b.map(function(c,d){return d%a?[]:[b.slice(d,d+a)]}))}}),Number.implement({bound:function(a,b){var c=this;return b=b||0,c>=a?c=0:b>c&&(c=a-1),c}}),Function.implement({debounce:function(a,b){var c,d=this;return function(){var e=this,f=arguments;clearTimeout(c),c=setTimeout(function(){c=null,b||d.apply(e,f)},a||150),b&&!c&&d.apply(e,f)}}}),Element.Events.clickout=function(){function a(a){var b=!0;return c.each(function(c){b&&(b=c!==a.target&&0===c.getElements(a.target).length)}),b}function b(b){a(b)&&c.fireEvent("clickout",[b.target])}var c=new Elements;return{base:"click",condition:a,onAdd:function(){c.push(this),1===c.length&&document.addEvent("click",b)},onRemove:function(){c.pop(this),0===c.length&&document.removeEvent("click",b)}}}(),Element.Properties.html.set=function(a){var b=typeOf(a);return"element"===b?(this.innerHTML="",this.appendChild(a),this):("string"===b&&a.match(/^#[a-z0-9_\-\.:]+$/i)?a=document.getElement(a).get("html"):"array"===b&&(a=a.join("")),this.innerHTML=a,this)}}(window);!function(){"use strict";Toolkit.Component=new Class({Implements:[Events,Options],Binds:["onShow","onHide","position"],cache:{},events:{},enabled:!1,element:null,nodes:null,node:null,options:{context:null,delegate:"",className:"",template:"",templateFrom:""},initialize:function(a){this.setOptions(a||{})},bindEvents:function(a){var b,c,d,e,f,g=this,h=window,i=document,j="on"===a?"addEvent":"removeEvent";return Object.each(this.events,function(a,k){f="array"===typeOf(a)?a:[a],c=k.split(" "),b=c[0],d=c[1],e=c[2]||null,"."!==d.charAt(0)&&"#"!==d.charAt(0)||"clickout"===b||(e=d,d=g.options.context),"undefined"!=typeof g[d]&&(d=g[d]),("array"!==typeOf(d)||d.length)&&f.each(function(a){"function"!==typeOf(a)&&(a=g[a].bind(g)),"window"===d?h[j](b,a):"document"===d?"ready"===b?h[j]("domready",a):i[j](b,a):"clickout"===b?$$(d)[j](b,a):e?(d||i)[j](b+":relay("+e+")",a):d[j](b,a)})}),this},className:function(){return Object.keyOf(window.Toolkit,this.$constructor)},createElement:function(){var a,b=this.options;if(this.element)return this;if(b.templateFrom&&(a="element"===typeOf(b.templateFrom)?b.templateFrom:document.getElement(b.templateFrom)),!a&&b.template&&(a=this.parseTemplate(b.template),a&&a.conceal().inject(document.body)),!a)throw new Error(this.className()+" failed to create template element");return b.className&&a.addClass(b.className),b.animation&&a.addClass(b.animation),this.element=a,this},disable:function(){return this.enabled=!1,this.bindEvents("off"),this},enable:function(){return this.enabled=!0,this.bindEvents("on"),this},hide:function(a){return this.isVisible()&&(this.element.conceal(),"function"===typeOf(a)&&a(),this.fireEvent("hide")),this},inheritOptions:function(a,b){var c,d,e={};for(c in a)"context"!==c&&"template"!==c&&(d=b.get("data"+this.className().hyphenate()+"-"+c.toLowerCase()),"null"!==typeOf(d)&&(e[c]=Toolkit.autobox(d)));return Object.merge({},a,e)},isVisible:function(){return this.element&&this.element.isShown()},parseTemplate:function(a){if(!a)return null;if("element"===typeOf(a))return a;var b=Elements.from(a);if(b[0])return b[0];throw new Error(this.className()+" template failed to parse")},position:function(a){return this.element.set("html",a),this.fireEvent("load",a),this},process:function(a){if(this.hide(),a.callback){for(var b=a.callback.split("."),c=window,d=c,e=0;e<b.length;e++)d=c,c=c[b[e]];c.call(d,a)}return this.fireEvent("process",a),this},readOption:function(a,b){var c=a.get("data"+this.className().hyphenate()+"-"+b.toLowerCase());return c="null"===typeOf(c)?this.options[b]:Toolkit.autobox(c)},readValue:function(a,b){return b?"function"===typeOf(b)?b.call(this,a):a.get(b):null},requestData:function(a,b,c,d){var e=a.url||a,f=Object.merge({url:e,method:"GET",evalScripts:!0,onRequest:b||function(){this.cache[e]=!0,this.element.addClass(Toolkit.options.isPrefix+"loading")}.bind(this)},a);"object"===typeOf(this.options.ajax)&&(f=Object.merge({},this.options.ajax,f));var g=this,h="GET"===f.method.toUpperCase();return f.onSuccess=c||function(a){var b=this.xhr.getResponseHeader("Content-Type");g.element.removeClass(Toolkit.options.isPrefix+"loading"),b.indexOf("text/html")>=0?(h?g.cache[e]=a:delete g.cache[e],g.position(a)):(delete g.cache[e],"application/json"===b&&(a=JSON.parse(a)),g.process(a))},f.onFailure=d||function(){delete this.cache[e],this.element.removeClass(Toolkit.options.isPrefix+"loading").addClass(Toolkit.options.hasPrefix+"failed"),this.position(this._errorTemplate())}.bind(this),new Request(f).send(),this},setOptions:function(a,b){if(a=Object.merge({},this.options,a||{}),b&&(a=this.inheritOptions(a,b)),a.mode&&"hover"===a.mode&&(a.mode=Toolkit.isTouch?"click":"mouseenter"),this.addEvent)for(var c in a)"function"===typeOf(a[c])&&/^on[A-Z]/.test(c)&&(this.addEvent(c,a[c]),delete a[c]);return this.options=a,this},show:function(a){return this.node=a,this.element.reveal(),this.fireEvent("show"),this},toElement:function(){return this.element},_errorTemplate:function(){return new Element("div."+this.className().hyphenate().slice(1)+"-error",{text:Toolkit.messages.error})}.protect(),_loadingTemplate:function(){return new Element("div."+this.className().hyphenate().slice(1)+"-loading",{text:Toolkit.messages.loading})}.protect(),onHide:function(a){"domevent"===typeOf(a)&&a.preventDefault(),this.hide()},onShow:function(a,b){if(this.enabled){if(b=b||a.target,this.isVisible()){if(Toolkit.isTouch?(b!==this.node||"a"!==this.node.get("tag"))&&a.preventDefault():a.preventDefault(),"click"===this.options.mode&&this.hide(),b===this.node)return}else"domevent"===typeOf(a)&&a.preventDefault();this.show(b)}}})}();