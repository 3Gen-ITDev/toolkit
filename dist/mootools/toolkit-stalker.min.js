/*!
 * Titon Toolkit v1.1.0
 * Copyright 2010-2014, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 */
!function(){"use strict";Toolkit.Stalker=new Class({Extends:Toolkit.Component,Binds:["onScroll"],container:null,targets:[],markers:[],offsets:[],options:{target:"",targetBy:"href",marker:"",markBy:"id",threshold:50,throttle:50,onlyWithin:!0,applyToParent:!0},initialize:function(a,b){if(this.parent(b),this.element=a,this.container="auto"===a.getStyle("overflow")?a:window,!this.options.target||!this.options.marker)throw new Error("A marker and target is required");a.addClass(Toolkit.options.vendor+"stalker"),this.refresh(),this.events={"scroll container":"onScroll","ready document":"onScroll"},this.enable(),this.fireEvent("init")},activate:function(a){return this._stalk(a,"activate"),this},deactivate:function(a){return this._stalk(a,"deactivate"),this},refresh:function(){return"auto"===this.element.getStyle("overflow")&&this.element!==document.body&&(this.element.scrollTop=0),this.targets=$$(this.options.target).addClass(Toolkit.options.vendor+"stalker-target"),this.markers=$$(this.options.marker).addClass(Toolkit.options.vendor+"stalker-marker"),this.offsets=this.markers.getCoordinates(this.element),this},_stalk:function(a,b){var c=Toolkit.options.isPrefix;if("activate"!==b||!a.hasClass(c+"stalked")){var d=this.options.targetBy,e=this.options.markBy,f="activate"===b?"addClass":"removeClass",g=this.targets.filter(function(b){return b.get(d).replace("#","")===a.get(e)});a[f](c+"stalked"),this.options.applyToParent?g.getParent()[f](c+"active"):g[f](c+"active"),this.fireEvent(b,[a,g])}},onScroll:function(){var a=this.container.getScroll().y,b=this.markers,c=this.offsets,d=this.options.onlyWithin,e=this.options.threshold;b.each(function(b,f){var g=c[f],h=g.top-e,i=g.top+g.height+e;d&&a>=h&&i>=a||!d&&a>=h?this.activate(b):this.deactivate(b)}.bind(this)),this.fireEvent("scroll")}}),Toolkit.createComponent("stalker",function(a){return new Toolkit.Stalker(this,a)})}();