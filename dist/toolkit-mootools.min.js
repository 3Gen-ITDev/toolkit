/*!
 * Titon Toolkit v0.13.0
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/toolkit/blob/master/license.md
 * Components: base, typography, grid, form, inputGroup, code, table, typeAhead, accordion, alert, labelBadge, badge, blackout, breadcrumbs, button, buttonGroup, cache, carousel, toggle, dropdown, timers, flyout, icon, label, lazyLoad, matrix, modal, pagination, pin, tooltip, popover, progress, showcase, tabs, visual, responsive
 */
!function(a){"use strict";a.Titon={version:"0.13.0",build:"hlx4uq0x",messages:{loading:"Loading...",error:"An error has occurred!"}},Element.implement({toolkit:function(a){return this["$"+a]||null},reveal:function(){return this.swapClass("hide","show")},conceal:function(){return this.swapClass("show","hide")},isShown:function(){return"hidden"!==this.getStyle("visibility")},positionTo:function(a,b,c,d){a=a.hyphenate().split("-");var e={y:a[0],x:a[1]},f=c||{left:0,top:0},g=0,h=0,i=this.getDimensions({computeSize:!0,styles:["padding","border","margin"]});if("domevent"===typeOf(b))f.left+=b.page.x,f.top+=b.page.y;else{var j=b.getPosition();f.left+=j.x,f.top+=j.y,g=b.getHeight(),h=b.getWidth()}return"top"===e.y?f.top-=i.totalHeight:"bottom"===e.y?f.top+=g:"center"===e.y&&(f.top-=Math.round(i.totalHeight/2-g/2)),"left"===e.x?f.left-=i.totalWidth:"right"===e.x?f.left+=h:"center"===e.x&&(f.left-=Math.round(i.totalWidth/2-h/2)),d&&("center"===e.y&&("left"===e.x?f.left-=15:"right"===e.x&&(f.left+=15)),"center"===e.x&&("top"===e.y?f.top-=10:"bottom"===e.y&&(f.top+=20))),this.setStyles(f)}}),Elements.implement({toolkit:function(a){var b="$"+a,c=null;return this.every(function(a){return a[b]?(c=a[b],!1):!0}),c}}),Array.implement({chunk:function(a){var b=this;return[].concat.apply([],b.map(function(c,d){return d%a?[]:[b.slice(d,d+a)]}))}}),Function.implement({debounce:function(a){var b,c=this;return function(){var d=this,e=arguments;clearTimeout(b),b=setTimeout(function(){c.apply(d,e),b=null},a||150)}}}),Element.Properties.html.set=function(a){var b=typeOf(a);return"element"===b?(this.innerHTML="",this.appendChild(a),this):("string"===b&&"#"===a.substr(0,1)?a=document.getElement(a).get("html"):"array"===b&&(a=a.join("")),this.innerHTML=a,this)}}(window);
!function(){"use strict";Titon.Component=new Class({Implements:[Events,Options],Binds:["__show","__hide","position"],cache:{},enabled:!0,element:null,nodes:null,node:null,options:{context:null,delegate:"",className:"",animation:"",mode:"click",errorMessage:null,loadingMessage:null,template:"",templateFrom:"",onInit:null,onHide:null,onShow:null},initialize:function(a){this.setOptions(a||{})},bindEvents:function(){var a,b=this.options,c="click"===b.mode?"click":"mouseenter";return b.delegate?(c+=":relay("+b.delegate+")",a=document.id(b.context||document.body)):this.element&&(a=this.element),a&&a.addEvent(c,this.__show),this},className:function(){return Object.keyOf(window.Titon,this.$constructor)},createElement:function(){var a,b=this.options;if(this.element)return this;if(b.templateFrom&&(a="element"===typeOf(b.templateFrom)?b.templateFrom:document.getElement(b.templateFrom)),!a&&b.template&&(a=this.parseTemplate(b.template),a&&a.conceal().inject(document.body)),!a)throw new Error(this.className()+" failed to create template element");return this.setElement(a),this},disable:function(){return this.enabled=!1,this},enable:function(){return this.enabled=!0,this},hide:function(a){return this.isVisible()&&(this.element.conceal(),"function"===typeOf(a)&&a(),this.fireEvent("hide")),this},isVisible:function(){return this.element&&this.element.isShown()},parseTemplate:function(a){if(!a)return null;if("element"===typeOf(a))return a;var b=Elements.from(a);if(b[0])return b[0];throw new Error(this.className()+" template failed to parse")},position:function(a){return this.element.set("html",a),this},readValue:function(a,b){return b?"function"===typeOf(b)?b.call(this,a):a.get(b):null},requestData:function(a){return this.cache[a]?this:(new Request({url:a,method:"get",evalScripts:!0,onSuccess:function(b){this.cache[a]=b,this.options.showLoading&&this.element.removeClass("is-loading"),this.position(b)}.bind(this),onRequest:function(){this.cache[a]=!0,this.options.showLoading&&(this.element.addClass("is-loading"),this.position(this._loadingTemplate()))}.bind(this),onFailure:function(){delete this.cache[a],this.element.removeClass("is-loading").addClass("has-failed"),this.position(this._errorTemplate())}.bind(this)}).get(),this)},setElement:function(a){return"string"===typeOf(a)&&(a=document.getElement(a)),this.element=a,this.options.template=!1,this.options.className&&this.element.addClass(this.options.className),this.options.animation&&this.element.addClass(this.options.animation),this},setNodes:function(a){return this.nodes=a,this},show:function(a){return this.node=a,this.element.reveal(),this.fireEvent("show"),this},toElement:function(){return this.element},_errorTemplate:function(){return new Element("div."+this.className().toLowerCase()+"-error",{text:this.options.errorMessage||Titon.messages.error})}.protect(),_loadingTemplate:function(){return new Element("div."+this.className().toLowerCase()+"-loading",{text:this.options.loadingMessage||Titon.messages.loading})}.protect(),__hide:function(a){"domevent"===typeOf(a)&&a.stop(),this.hide()},__show:function(a,b){"domevent"===typeOf(a)&&a.stop(),this.enabled&&(b=b||a.target,this.isVisible()&&("click"===this.options.mode&&this.hide(),b===this.node)||this.show(b))}})}();
!function(){"use strict";Titon.TypeAhead=new Class({Extends:Titon.Component,Implements:[Cache],Binds:["process","rewind","__cycle","__lookup"],input:null,shadow:null,index:-1,items:[],term:"",timer:null,options:{source:[],minLength:1,itemLimit:15,throttle:250,prefetch:!1,shadow:!1,storage:"session",query:{},contentElement:"",template:'<div class="type-ahead"></div>',sorter:null,matcher:null,builder:null,onSelect:null,onReset:null},initialize:function(a,b){if(this.parent(b),this.createElement(),this.input=a,"input"!==this.input.get("tag"))throw new Error("TypeAhead must be initialized on an input field");if(this.input.set("autocomplete","off"),b=this.options,this.setStorage(b.storage),Object.each({sorter:"sort",matcher:"match",builder:"build"},function(a,c){if(b[c]!==!1){var d;d=null===b[c]||"function"!==typeOf(b[c])?this[a]:b[c],this.options[c]=d.bind(this)}}.bind(this)),b.prefetch&&"string"===typeOf(b.source)){var c=b.source;new Request.JSON({url:c,data:b.query,onSuccess:function(a){this.setCache(c,a)}.bind(this)}).get()}b.shadow&&(this.node=new Element("div.type-ahead-shadow").wraps(this.input),this.shadow=this.input.clone().addClass("is-shadow").removeProperty("id").set("readonly",!0).inject(this.node,"bottom"),this.input.addClass("not-shadow")),this.bindEvents(),this.fireEvent("init")},bindEvents:function(){return window.addEvent("keydown",function(a){"esc"===a.key&&this.isVisible()&&this.hide()}.bind(this)),this.input.addEvents({keyup:this.__lookup,keydown:this.__cycle}),this},build:function(a){var b=new Element("a",{href:"javascript:;"});return b.grab(new Element("span.type-ahead-title",{html:this.highlight(a.title)})),a.description&&b.grab(new Element("span.type-ahead-desc",{html:a.description})),b},hide:function(){return this.shadow&&this.shadow.set("value",""),this.parent()},highlight:function(a){for(var b,c=this.term.replace(/[\-\[\]\{\}()*+?.,\\^$|#]/g,"\\$&").split(" "),d=function(a){return'<span class="type-ahead-highlight">'+a+"</span>"},e=0;b=c[e];e++)a=a.replace(new RegExp(b,"ig"),d);return a},lookup:function(a){return this.term=a,this.timer=window.setTimeout(function(){var b=this.options,c=typeOf(b.source);if(this.cache[a.toLowerCase()])this.process(this.cache[a.toLowerCase()]);else if("string"===c){var d=b.source,e=this.getCache(d);if(e)this.process(e);else{var f=b.query;f.term=a,new Request.JSON({url:d,data:f,onSuccess:this.process}).get()}}else if("array"===c)this.process(b.source);else{if("function"!==c)throw new Error("Invalid TypeAhead source type");var g=b.source.attempt([],this);g&&this.process(g)}}.bind(this),this.options.throttle),this},match:function(a,b){return a.toLowerCase().indexOf(b.toLowerCase())>=0},position:function(){if(!this.items.length)return this.hide();var a=this.input.getCoordinates();return this.element.setPosition({x:a.left,y:a.top+a.height}),this.element.reveal(),this},process:function(a){if(!this.term.length||!a.length)return this.hide(),this;var b,c=this.options,d={_empty_:[]},e=new Element("ul");this.items=[],this.index=-1,"function"===typeOf(c.sorter)&&(a=c.sorter(a)),"function"===typeOf(c.matcher)&&(a=a.filter(function(a){return c.matcher(a.title,this.term)}.bind(this)));for(var f=0;b=a[f];f++)b.category?(d[b.category]||(d[b.category]=[]),d[b.category].push(b)):d._empty_.push(b);var g=[],h=0;return Object.each(d,function(a,d){var f=new Elements;"_empty_"!==d&&(g.push(null),f.push(new Element("li").addClass("heading").grab(new Element("span",{text:d}))));for(var i,j=0;(b=a[j])&&!(h>=c.itemLimit);j++)i=c.builder(b),i.addEvents({mouseover:this.rewind,click:this.__select.pass(g.length,this)}),f.push(new Element("li").grab(i)),g.push(b),h++;f.inject(e)}.bind(this)),this.element.empty(),c.contentElement?this.element.getElement(c.contentElement).grab(e):this.element.grab(e),this.items=g,this.cache[this.term.toLowerCase()]=g.filter(function(a){return null!==a}),this._shadow(),this.position(),this.fireEvent("show"),this},rewind:function(){return this.index=-1,this.element.getElements("li").removeClass("is-active"),this},select:function(a){this.index=a;var b=this.element.getElements("li");if(b.removeClass("is-active"),a>=0){if(this.items[a]){var c=this.items[a];b[a].addClass("is-active"),this.input.set("value",c.title),this.fireEvent("select",[c,a])}}else this.input.set("value",this.term),this.fireEvent("reset");return this},sort:function(a){return a.sort(function(a,b){return a.title.localeCompare(b.title)})},_shadow:function(){if(this.shadow){var a=this.input.get("value"),b=a.toLowerCase(),c="";if(this.cache[b]&&this.cache[b][0]){var d=this.cache[b][0].title;0===d.toLowerCase().indexOf(b)&&(c=a+d.substr(a.length,d.length-a.length))}return this.shadow.set("value",c),this}}.protect(),__cycle:function(a){var b=this.items,c=b.length.limit(0,this.options.itemLimit);if(c&&this.isVisible()){switch(a.key){case"up":this.index-=b[this.index-1]?1:2,this.index<0&&(this.index=c);break;case"down":this.index+=b[this.index+1]?1:2,this.index>=c&&(this.index=-1);break;case"tab":a.preventDefault();for(var d=0;!this.items[d];)d++;this.index=d,this.hide();break;case"enter":this.hide();break;case"esc":this.index=-1,this.hide();break;default:return}this.shadow&&this.shadow.set("value",""),this.select(this.index)}},__lookup:function(a){if(!["up","down","esc","tab","enter"].contains(a.key)){window.clearTimeout(this.timer);var b=this.input.get("value").trim();b.length<this.options.minLength?(this.fireEvent("reset"),this.hide()):(this._shadow(),this.lookup(b))}},__select:function(a){this.select(a),this.hide()}}),Element.implement("typeAhead",function(a){return this.$typeAhead||(this.$typeAhead=new Titon.TypeAhead(this,a)),this})}();
!function(){"use strict";Titon.Accordion=new Class({Extends:Titon.Component,headers:[],sections:[],options:{mode:"click",defaultIndex:0,multiple:!1,collapsible:!1,headerElement:".accordion-head",contentElement:".accordion-inner"},initialize:function(a,b){this.parent(b),this.setElement(a),b=this.options;var c=this.element.getElements(b.contentElement),d=this.element.getElements(b.headerElement),e=d[0];this.headers=d,this.sections=c,d[b.defaultIndex]&&(e=d[b.defaultIndex]),this.element.getChildren("li").removeClass("is-active"),c.each(function(a){a.set("data-height",a.getHeight()).conceal()}),this.show(e),this.bindEvents(),this.fireEvent("init")},bindEvents:function(){return this.element?(this.headers.addEvent("click"===this.options.mode?"click":"mouseover",this.__show),this):this},show:function(a){var b=this.options,c=a.getParent(),d=a.getNext(b.contentElement),e=2*d.get("data-height");if(b.multiple||b.collapsible&&this.node===a)d.isShown()&&this.node?(d.setStyle("max-height",0).conceal(),c.removeClass("is-active")):(d.setStyle("max-height",e).reveal(),c.addClass("is-active"));else{if(this.node===a)return this;this.sections.setStyle("max-height",0).conceal(),d.setStyle("max-height",e).reveal(),this.element.getChildren("li").removeClass("is-active"),c.addClass("is-active")}return this.node=a,this.fireEvent("show",d),this},__show:function(a){if(a.stop(),this.enabled){for(var b=a.target,c=this.options.headerElement.substr(1);b&&!b.hasClass(c);)b=b.getParent();b&&this.show(b)}}}),Element.implement("accordion",function(a){return this.$accordion||(this.$accordion=new Titon.Accordion(this,a)),this})}();
!function(){"use strict";Titon.Blackout=new Class({Extends:Titon.Component,options:{template:'<div class="blackout" id="titon-blackout"></div>',templateFrom:"#titon-blackout"},initialize:function(a){this.parent(a),this.createElement(),window.addEvent("resize",this.position.bind(this)),this.fireEvent("init")},hide:function(){return this.element.conceal(),this.fireEvent("hide"),this},position:function(){if(this.isVisible()){var a=window.getSize();this.element.setStyles({width:a.x,height:a.y})}return this},show:function(){return this.element.reveal(),this.position(),this.fireEvent("show"),this}})}();
!function(a){"use strict";a.Cache=new Class({storage:null,setStorage:function(b){if(!a.JSON)throw new Error("JSON is required for caching and storage");switch(b.toLowerCase()){case"local":case"localstorage":if(a.localStorage)try{return a.localStorage.setItem("_temp_","Titon"),a.localStorage.removeItem("_temp_"),this.storage=a.localStorage,void 0}catch(c){}case"session":case"sessionstorage":if(a.sessionStorage)try{return a.sessionStorage.setItem("_temp_","Titon"),a.sessionStorage.removeItem("_temp_"),this.storage=a.sessionStorage,void 0}catch(d){}default:this.storage=function(){var a={},b=0;return{length:b,clear:function(){a={},b=0},getItem:function(b){return a[b]||null},setItem:function(c,d){a[c]=d,b++},removeItem:function(c){delete a[c],b--}}}()}},cacheSize:function(){return this.storage.length||0},flushCache:function(){this.storage&&this.storage.clear()},getCache:function(a){if(this.storage&&a){var b=this.storage.getItem(a);if(b)return JSON.parse(b)}return null},hasCache:function(a){return this.storage&&this.storage.getItem(a)},setCache:function(a,b){if(this.storage&&a)try{return this.storage.setItem(a,JSON.stringify(b||"")),!0}catch(c){}return!1},removeCache:function(a){this.storage&&a&&this.storage.removeItem(a)}})}(window);
!function(){"use strict";Titon.Carousel=new Class({Extends:Titon.Component,Binds:["next","prev","start","stop","resize","__cycle","__jump"],stopped:!1,itemsWrapper:null,items:[],itemWidth:0,itemHeight:0,tabsWrapper:null,tabs:[],prevButton:null,nextButton:null,previousIndex:0,currentIndex:0,timer:null,options:{animation:"slide",duration:5e3,autoCycle:!0,stopOnHover:!0,itemsElement:".carousel-items",itemElement:"li",tabsElement:".carousel-tabs",tabElement:"a",nextElement:".carousel-next",prevElement:".carousel-prev",template:!1,onStart:null,onStop:null,onCycle:null,onJump:null},initialize:function(a,b){if(this.parent(b),this.setElement(a),this.element){if(b=this.options,this.itemsWrapper=this.element.getElement(b.itemsElement),this.itemsWrapper&&(this.items=this.itemsWrapper.getElements(b.itemElement)),this.tabsWrapper=this.element.getElement(b.tabsElement),this.tabsWrapper&&(this.tabs=this.tabsWrapper.getElements(b.tabElement)),this.nextButton=this.element.getElement(b.nextElement),this.prevButton=this.element.getElement(b.prevElement),this.items.length<=1)return this.tabsWrapper.hide(),this.nextButton.hide(),this.prevButton.hide(),void 0;switch(b.animation){case"fade":this.items[0].reveal();break;case"slide":this.itemsWrapper.setStyle("width",100*this.items.length+"%"),this.items.setStyle("width",100/this.items.length+"%")}this.tabs.forEach(function(a,b){a.set("data-index",b)}),window.addEvent("keydown",function(a){switch(["up","down","left","right"].contains(a.key)&&a.preventDefault(),a.key){case"up":this.jump(0);break;case"down":this.jump(-1);break;case"left":this.prev();break;case"right":this.next()}}.bind(this)),window.addEvent("resize",this.resize),this.bindEvents(),this.fireEvent("init")}},bindEvents:function(){return this.element?(this.options.stopOnHover&&this.element.addEvent("mouseenter",this.stop).addEvent("mouseleave",this.start),this.tabs.length&&this.tabs.addEvent("click",this.__jump),this.nextButton&&this.nextButton.addEvent("click",this.next),this.prevButton&&this.prevButton.addEvent("click",this.prev),this.start().reset(),this):this},jump:function(a){switch(a>=this.items.length?a=0:0>a&&(a=this.items.length-1),this.previousIndex=this.currentIndex,this.currentIndex=a,this.tabs.length&&(this.tabs.removeClass("is-active"),this.tabs[a]&&this.tabs[a].addClass("is-active")),this.options.animation){case"fade":this.items.removeClass("show"),this.items[a].reveal();break;case"slide-up":this.itemHeight||this.resize(),this.itemsWrapper.setStyle("top",-(a*this.itemHeight)+"px");break;default:this.itemsWrapper.setStyle("left",-(100*a)+"%")}return this.reset(),this.fireEvent("jump",a),this},next:function(){return this.jump(this.currentIndex+1),this},prev:function(){return this.jump(this.currentIndex-1),this},reset:function(){return this.options.autoCycle&&(clearInterval(this.timer),this.timer=setInterval(this.__cycle,this.options.duration)),this},resize:function(){var a=this.items[0].measure(function(){return this.getSize()});return this.itemWidth=a.x,this.itemHeight=a.y,"slide"!==this.options.animation&&this.itemsWrapper.setStyle("height",a.y+"px"),this},start:function(){return this.element.removeClass("is-stopped"),this.stopped=!1,this.fireEvent("start"),this},stop:function(){return this.element.addClass("is-stopped"),this.stopped=!0,this.fireEvent("stop"),this},__cycle:function(){this.enabled&&(this.itemWidth&&this.itemHeight||this.resize(),this.stopped||(this.fireEvent("cycle"),this.next()))},__jump:function(a){a.stop(),this.enabled&&this.jump(a.target.get("data-index")||0)}}),Element.implement("carousel",function(a){return this.$carousel||(this.$carousel=new Titon.Carousel(this,a)),this})}();
!function(){"use strict";Titon.Toggle=new Class({Extends:Titon.Component,options:{getTarget:"data-toggle",hideOpened:!0},initialize:function(a,b){this.parent(b),this.setNodes(a),window.addEvent("click",this.hide.bind(this)),this.bindEvents(),this.fireEvent("init")},hide:function(){return this.parent(function(){this.node.removeClass("is-active")}.bind(this))},show:function(a){return this.parent(a),this.node.addClass("is-active"),this},__show:function(a,b){if("domevent"===typeOf(a)&&a.stop(),this.enabled){var c=this.readValue(b,this.options.getTarget);c&&"#"===c.substr(0,1)&&(this.options.hideOpened&&this.node&&this.node!==b&&this.hide(),this.setElement(c),this.isVisible()?this.hide():this.show(b))}}}),Elements.implement("dropdown",function(a){a=a||{},a.delegate=a.delegate||".js-dropdown";var b=new Titon.Toggle(this,a);return this.each(function(a){a.$dropdown||(a.$dropdown=b)})})}();
!function(a){"use strict";a.Timers=new Class({timers:{},$timers:{},addTimer:function(a,b){return this.timers[a]=Function.from(b),this},addTimers:function(a){for(var b in a)this.addTimer(b,a[b]);return this},startTimer:function(a,b,c){return this.clearTimer(a),this.timers[a]&&(this.$timers[a]=this.timers[a].delay(b,this,c)),this},startInterval:function(a,b,c){return this.clearTimer(a),this.timers[a]&&(this.$timers[a]=this.timers[a].periodical(b,this,c)),this},clearTimer:function(b,c,d){return a.clearTimeout(this.$timers[b]),delete this.$timers[b],"function"===typeOf(c)&&c.apply(this,d||[]),this},clearTimers:function(a){return a?Array.from(a).each(function(a){this.clearTimer(a)},this):Object.each(this.$timers,function(a,b){this.clearTimer(b)},this),this},removeTimer:function(a){return delete this.timers[a],this},removeTimers:function(a){return Array.from(a).each(function(a){this.removeTimer(a)},this),this}})}(window);
!function(){"use strict";Titon.Flyout=new Class({Extends:Titon.Component,Implements:[Timers],current:null,menus:{},data:[],dataMap:{},options:{delegate:".js-flyout",mode:"hover",getUrl:"href",xOffset:0,yOffset:0,showDelay:350,hideDelay:1e3,itemLimit:15,contentElement:".flyout",template:'<div class="flyout"></div>',onHideChild:null,onShowChild:null},initialize:function(a,b,c){if(this.parent(c),this.setNodes(a),!b)throw new Error("Flyout URL required to download sitemap JSON");new Request.JSON({url:b,secure:!0,onSuccess:this.load.bind(this)}).get(),this.addTimers({show:this.position,hide:this.__hide}),c=this.options,"hover"===c.mode&&$(c.context||document.body).addEvent("mouseenter:relay("+c.delegate+")",function(){this.clearTimer("hide").startTimer("show",c.showDelay)}.bind(this)).addEvent("mouseleave:relay("+c.delegate+")",function(){this.clearTimer("show").startTimer("hide",c.showDelay)}.bind(this)),this.bindEvents(),this.fireEvent("init")},hide:function(){return this.clearTimers(),this.node.removeClass("is-active"),this.current&&this.isVisible()?(this.menus[this.current].conceal(),this.fireEvent("hide"),this.current=null,this):this},isVisible:function(){return this.current&&this.menus[this.current]&&(this.element=this.menus[this.current]),this.parent()},load:function(a,b){if(b=b||0,0===b&&(this.data=a),this.dataMap[a.url]=a,a.children)for(var c=0,d=a.children.length;d>c;c++)this.load(a.children[c],b+1);return this},position:function(){var a=this.current,b=this.options;if(!this.menus[a])return this;var c=this.menus[a],d=c.getDimensions().height,e=this.node.getCoordinates(),f=e.left+b.xOffset,g=e.top+b.yOffset+e.height,h=window.getScrollSize();return g>h.y/2&&(g=e.top-b.yOffset-d),c.setPosition({x:f,y:g}).reveal(),this.fireEvent("show"),this},show:function(a){var b=this._getTarget(a);return this.current&&b!==this.current&&(this.hide(),this.startTimer("show",this.options.showDelay)),this.node=a,this._getMenu()?(this.node.addClass("is-active"),"click"===this.options.mode&&this.position(),this):this},_buildMenu:function(a,b){if(!b.children||!b.children.length)return null;var c,d,e,f=this.parseTemplate(this.options.template),g=[],h=this.options.contentElement,i=this.options.itemLimit;this.options.className&&f.addClass(this.options.className),a===document.body&&f.addClass("flyout-root"),i&&b.children.length>i?g=b.children.chunk(i):g.push(b.children);for(var j,k=0;j=g[k];k++){c=new Element("ul");for(var l,m=0,n=j.length;n>m;m++)l=j[m],d=new Element("li"),l.url?e=new Element("a",{text:l.title,href:l.url}):(e=new Element("span",{text:l.title}),d.addClass("heading")),l.attributes&&e.set(l.attributes),new Element("span").addClass(l.icon||"caret-right").inject(e,"top"),l.className&&d.addClass(l.className),d.grab(e).inject(c),l.children&&l.children.length&&(this._buildMenu(d,l),d.addClass("has-children").addEvent("mouseenter",this.__positionChild.bind(this,d)).addEvent("mouseleave",this.__hideChild.bind(this,d)));h?"."===h.substr(0,1)&&f.hasClass(h.substr(1))?f.grab(c):f.getElement(h).grab(c):f.grab(c)}return f.inject(a),f}.protect(),_getMenu:function(){var a=this._getTarget();if(this.menus[a])return this.current=a,this.menus[a];if(this.dataMap[a]){var b=this._buildMenu(document.body,this.dataMap[a]);return b?(b.conceal(),"hover"===this.options.mode&&b.addEvents({mouseenter:function(){this.clearTimer("hide")}.bind(this),mouseleave:function(){this.startTimer("hide",this.options.hideDelay)}.bind(this)}),this.current=a,this.menus[a]=b,this.menus[a]):null}return null}.protect(),_getTarget:function(a){return a=a||this.node,this.readValue(a,this.options.getUrl)||a.get("href")}.protect(),__hideChild:function(a){a.removeClass("is-open"),a.getChildren(this.options.contentElement).removeProperty("style"),this.fireEvent("hideChild",a)},__positionChild:function(a){var b=a.getElement(this.options.contentElement);if(b){var c=b.getChildren("ul");b.setStyle("width",c.getWidth()*c.length+"px");var d=window.getScrollSize(),e=window.getCoordinates(),f=a.getCoordinates(),g=b.getCoordinates(),h=f.right+g.width;h>=e.width?b.addClass("flyout--left"):b.removeClass("flyout--left"),f.top>d.y/2?b.setStyle("top","-"+(g.height-f.height)+"px"):b.setStyle("top",0),a.addClass("is-open"),this.fireEvent("showChild",a)}}}),Elements.implement("flyout",function(a,b){var c=new Titon.Flyout(this,a,b);return this.each(function(a){a.$flyout||(a.$flyout=c)})})}();
!function(){"use strict";Titon.LazyLoad=new Class({Extends:Titon.Component,Binds:["load","loadAll"],isLoaded:!1,loaded:0,options:{lazyClass:".lazy-load",forceLoad:!1,delay:1e4,threshold:150,context:null,onLoad:null,onLoadAll:null,onShow:null,onShutdown:null},initialize:function(a,b){this.parent(b),this.setElement(a),this.element.length&&(document.id(this.options.context||window).addEvent("scroll:throttle(50)",this.load).addEvent("resize:throttle(50)",this.load),window.addEvent("domready",function(){this.load(),this.options.forceLoad&&window.setTimeout(this.loadAll,this.options.delay)}.bind(this)))},inViewport:function(a){var b=this.options.threshold,c=window.getScroll(),d=window.getSize(),e=a.getPosition();return e.y>=c.y-b&&e.y<=c.y+d.y+b&&e.x>=c.x-b&&e.x<=c.x+d.x+b},load:function(){return this.isLoaded?!1:this.loaded===this.element.length?(this.shutdown(),!1):(this.element.each(function(a,b){a&&this.inViewport(a)&&this.show(a,b)},this),this.fireEvent("load"),!0)},loadAll:function(){return this.isLoaded?!1:(this.element.each(function(a,b){a&&this.show(a,b)},this),this.fireEvent("loadAll"),this.shutdown(),!0)},show:function(a,b){return a.removeClass(this.options.lazyClass.substr(1)),a.getElements("img").each(function(a){var b=a.get("data-lazyload");b&&a.set("src",b)}),this.element.splice(b,1,null),this.loaded++,this.fireEvent("show",a),this},shutdown:function(){return this.isLoaded=!0,document.id(this.options.context||window).removeEvents({scroll:this.load,resize:this.load}),this.fireEvent("shutdown"),this}}),Elements.implement("lazyLoad",function(a){var b=new Titon.LazyLoad(this,a);return this.each(function(a){a.$lazyLoad||(a.$lazyLoad=b)})})}();
!function(){"use strict";Titon.Matrix=new Class({Extends:Titon.Component,Binds:["__resize","__load"],items:[],matrix:[],wrapperWidth:0,colWidth:0,colCount:0,images:[],imagesLoaded:0,options:{selector:".matrix-item",width:200,gutter:20,rtl:!1,defer:!0,template:!1,onRender:null},initialize:function(a,b){this.parent(b),this.setElement(a),this.element.addClass("matrix"),this.items=this.element.getElements(this.options.selector),window.addEvent("resize",this.__resize.debounce()),this.fireEvent("init"),this.options.defer?this._deferRender():this.render()},append:function(a){return"element"!==typeOf(a)?this:(a.addClass("matrix-item").inject(this.element,"bottom").setStyle("opacity",0),this.refresh())},disable:function(){return this.element.removeProperty("style"),this.items.removeClass("matrix-item").removeProperty("style"),this},enable:function(){return this.items.addClass("matrix-item"),this},prepend:function(a){return"element"!==typeOf(a)?this:(a.addClass("matrix-item").inject(this.element,"top").setStyle("opacity",0),this.refresh())},refresh:function(){return this.items=this.element.getElements(this.options.selector),this.render()},remove:function(a){return this.items.every(function(b){return b===a?(b.destroy(),!1):!0}),this.refresh()},render:function(){return this._calculateColumns(),this.items.length<this.colCount?this.disable():(this.enable(),this.colCount<=1?(this.element.addClass("no-columns"),this.items.removeProperty("style")):(this.element.removeClass("no-columns"),this._organizeItems(),this._positionItems()),this.fireEvent("render"),this)},_calculateColumns:function(){var a,b=this.element.getSize().x,c=this.options.width,d=this.options.gutter,e=Math.max(Math.floor(b/c),1),f=e*(c+d)-d;return e>1&&(f>b?(a=f-b,c-=a/e):b>f&&(a=b-f,c+=a/e)),this.wrapperWidth=b,this.colWidth=c,this.colCount=e,this}.protect(),_deferRender:function(){return this.imagesLoaded=0,this.images=this.element.getElements("img"),this.images.each(function(a){var b=a.src;a.onload=this.__load,a.onerror=this.__load,a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a.src=b},this),this}.protect(),_organizeItems:function(){var a,b,c,d=0,e=this.items.length;this.matrix=[];for(var f=0;e>f;f++){if(a=this.items[f],c=a.getSize(),b=Math.max(Math.round(c.x/this.colWidth),1),this.matrix.push({item:a,span:b}),b>1)for(var g=1;b>g;g++)d++,this.matrix&&this.matrix.push({item:a,span:!1});d++,d>=this.colCount&&(d=0)}return this}.protect(),_positionItems:function(){var a,b,c,d,e,f,g=this.options.gutter,h=this.matrix,i=this.options.rtl?"right":"left",j=0,k=[],l=0,m={margin:0};for(d=0;d<this.colCount;d++)k.push(0);for(d=0,e=h.length;e>d;d++){if(a=h[d],b=a.span,(l>=this.colCount||b+l>this.colCount)&&(l=0,j=0),b){for(c=0,f=0;b>f;f++)k[l+f]>c&&(c=k[l+f]);for(m.top=c,m[i]=j,m.width=(this.colWidth+g)*b-g,a.item.setStyles(m).reveal(),f=0;b>f;f++)k[l+f]=a.item.getSize().y+g+c}j+=this.colWidth+g,l++}return this.element.setStyle("height",Math.max.apply(Math,k)),this}.protect(),__load:function(a){(!a||"load"===a.type&&a.target.complete||"error"===a.type&&!a.target.complete)&&this.imagesLoaded++,this.imagesLoaded===this.images.length&&this.render()},__resize:function(){this.element.hasClass("matrix")&&this.refresh()}}),Element.implement("matrix",function(a){return this.$matrix||(this.$matrix=new Titon.Matrix(this,a)),this})}();
!function(){"use strict";Titon.Modal=new Class({Extends:Titon.Component,Binds:["__submit"],blackout:null,drag:null,elementBody:null,options:{delegate:".js-modal",animation:"fade",ajax:!0,draggable:!1,blackout:!0,showLoading:!0,getContent:"data-modal",contentElement:".modal-inner",closeElement:".modal-close",closeEvent:".modal-event-close",submitEvent:".modal-event-submit",template:'<div class="modal"><div class="modal-outer"><div class="modal-inner"></div><button type="button" class="close modal-event-close"><span class="x">&times;</span></button></div></div>',onSubmit:null},initialize:function(a,b){this.parent(b),this.setNodes(a),this.createElement(),this.elementBody=this.element.getElement(this.options.contentElement),this.options.draggable&&(this.drag=new Drag(this.element,{onStart:function(a){a.addClass("is-dragging")},onComplete:function(a){a.removeClass("is-dragging")}}),this.element.addClass("is-draggable")),this.options.blackout&&(this.blackout=new Titon.Blackout,this.blackout.element.addEvent("click",this.__hide)),this.bindEvents()},bindEvents:function(){return this.parent(),window.addEvent("keydown",function(a){"esc"===a.key&&this.isVisible()&&this.hide()}.bind(this)),this.element.addEvent("click:relay("+this.options.closeEvent+")",this.__hide).addEvent("click:relay("+this.options.submitEvent+")",this.__submit),this},hide:function(){return this.parent(function(){this.options.blackout&&this.blackout.hide()}.bind(this))},position:function(a){if(a===!0)return this;if(this.elementBody.set("html",a),!this.isVisible()&&(this.options.blackout&&this.blackout.show(),this.element.reveal(),Browser.ie8)){var b=this.element.getSize();this.element.setStyles({"margin-left":-(b.x/2),"margin-top":-(b.y/2)})}return this.fireEvent("show"),this},show:function(a,b){var c=this.options;return b?c.ajax=!1:a&&(b=this.readValue(a,c.getContent)||a.get("href"),"#"===b.substr(0,1)&&(c.ajax=!1)),b?(this.node=a,c.ajax?this.cache[b]?this.position(this.cache[b]):this.requestData(b):this.position(b),this):this},__submit:function(a){a.stop();var b=a.target,c=b.getParent("form");c&&(this.fireEvent("submit",b),new Request({url:c.get("action"),method:c.get("method").toUpperCase(),data:c.toQueryString(),evalScripts:!0,onSuccess:function(a){this.position(a)}.bind(this),onFailure:function(){this.position(this._errorTemplate())}.bind(this)}).send())}}),Elements.implement("modal",function(a){var b=new Titon.Modal(this,a);return this.each(function(a){a.$modal||(a.$modal=b)})})}();
!function(){"use strict";Titon.Pin=new Class({Extends:Titon.Component,Binds:["__resize","__scroll"],viewport:null,elementSize:null,parentSize:null,options:{animation:"pin",location:"right",xOffset:0,yOffset:0,throttle:50,template:!1,onScroll:null,onResize:null},initialize:function(a,b){this.parent(b),this.setElement(a),this.element&&(window.addEvent("scroll:throttle("+this.options.throttle+")",this.__scroll),window.addEvent("resize:throttle("+this.options.throttle+")",this.__resize),window.addEvent("domready",this.__resize),this.fireEvent("init"))},__resize:function(){this.viewport=window.getSize(),this.elementSize=this.element.getCoordinates(),this.parentSize=this.element.getParent().getCoordinates(),this.parentSize.height>=2*this.elementSize.height?this.enable():this.disable(),this.fireEvent("resize")},__scroll:function(){if(this.enabled){var a=this.options,b=this.elementSize,c=this.parentSize,d=window.getScroll(),e={},f=0,g=0;if(d.y>c.top){f=a.xOffset,g=a.yOffset;var h=d.y+b.height,i=c.height+c.top;g+=h>=i?c.height-b.height:d.y-c.top}e.position="absolute",e[a.location]=f,e.top=g,this.element.setStyles(e),this.fireEvent("scroll")}}}),Element.implement("pin",function(a){return this.$pin||(this.$pin=new Titon.Pin(this,a)),this})}();
!function(){"use strict";Titon.Tooltip=new Class({Extends:Titon.Component,Binds:["__follow"],elementHead:null,elementBody:null,options:{delegate:".js-tooltip",mode:"hover",ajax:!1,follow:!1,position:"topRight",showLoading:!0,showTitle:!0,getTitle:"title",getContent:"data-tooltip",mouseThrottle:50,xOffset:0,yOffset:0,delay:0,titleElement:".tooltip-head",contentElement:".tooltip-body",template:'<div class="tooltip"><div class="tooltip-inner"><div class="tooltip-head"></div><div class="tooltip-body"></div></div><div class="tooltip-arrow"></div></div>'},initialize:function(a,b){this.parent(b),this.setNodes(a),this.createElement(),this.elementHead=this.element.getElement(this.options.titleElement),this.elementBody=this.element.getElement(this.options.contentElement),this.element.addClass(this.options.position.hyphenate()),this.bindEvents(),this.fireEvent("init")},position:function(a,b){var c=this.options;if(a===!0)return this;if(b&&c.showTitle?this.elementHead.set("html",b).show():this.elementHead.hide(),a?this.elementBody.set("html",a).show():this.elementBody.hide(),c.follow){var d="mousemove:throttle("+c.mouseThrottle+")";this.node.removeEvent(d,this.__follow).addEvent(d,this.__follow),this.fireEvent("show")}else this.element.positionTo(c.position,this.node,{left:c.xOffset,top:c.yOffset}),window.setTimeout(function(){this.element.reveal(),this.fireEvent("show")}.bind(this),c.delay||0);return this},show:function(a,b,c){return a&&("hover"===this.options.mode&&a.removeEvent("mouseleave",this.__hide).addEvent("mouseleave",this.__hide),c=c||this.readValue(a,this.options.getTitle),b=b||this.readValue(a,this.options.getContent)),b?(this.node=a,this.options.ajax?this.cache[b]?this.position(this.cache[b],c):this.requestData(b):this.position(b,c),this):this},__follow:function(a){a.stop();var b=this.options;this.element.positionTo(b.position,a,{left:b.xOffset,top:b.yOffset},!0).reveal()}}),Elements.implement("tooltip",function(a){var b=new Titon.Tooltip(this,a);return this.each(function(a){a.$tooltip||(a.$tooltip=b)})})}();
!function(){"use strict";Titon.Popover=new Class({Extends:Titon.Tooltip,options:{delegate:".js-popover",position:"topCenter",getContent:"data-popover",titleElement:".popover-head",contentElement:".popover-body",template:'<div class="popover"><div class="popover-inner"><div class="popover-head"></div><div class="popover-body"></div></div><div class="popover-arrow"></div></div>'},initialize:function(a,b){b=b||{},b.mode="click",b.follow=!1,this.parent(a,b)}}),Elements.implement("popover",function(a){var b=new Titon.Popover(this,a);return this.each(function(a){a.$popover||(a.$popover=b)})})}();
!function(){"use strict";Titon.Showcase=new Class({Extends:Titon.Component,Binds:["next","prev","__jump"],items:null,tabs:null,prevButton:null,nextButton:null,data:[],previousIndex:0,currentIndex:0,blackout:null,options:{delegate:".js-showcase",blackout:!0,transition:300,getCategory:"data-showcase",getImage:"href",getTitle:"title",itemsElement:".showcase-items",tabsElement:".showcase-tabs",prevElement:".showcase-prev",nextElement:".showcase-next",closeEvent:".showcase-event-close",jumpEvent:".showcase-event-jump",prevEvent:".showcase-event-prev",nextEvent:".showcase-event-next",template:'<div class="showcase"><div class="showcase-inner"><ul class="showcase-items"></ul><ol class="showcase-tabs"></ol><a href="javascript:;" class="showcase-prev showcase-event-prev"><span class="icon-chevron-sign-left"></span></a><a href="javascript:;" class="showcase-next showcase-event-next"><span class="icon-chevron-sign-right"></span></a><button type="button" class="close showcase-event-close"><span class="x">&times;</span></button></div></div>',onJump:null},initialize:function(a,b){this.parent(b),this.setNodes(a),this.createElement(),(Browser.ie8||Browser.ie9)&&(this.options.transition=1),b=this.options,this.items=this.element.getElement(b.itemsElement),this.tabs=this.element.getElement(b.tabsElement),this.prevButton=this.element.getElement(b.prevElement),this.nextButton=this.element.getElement(b.nextElement),this.options.blackout&&(this.blackout=new Titon.Blackout,this.blackout.element.addEvent("click",this.__hide)),this.bindEvents(),this.fireEvent("init")},bindEvents:function(){return this.parent(),window.addEvent("keydown",function(a){if(this.isVisible())switch(["up","down","left","right"].contains(a.key)&&a.preventDefault(),a.key){case"esc":this.hide();break;case"up":this.jump(0);break;case"down":this.jump(-1);break;case"left":this.prev();break;case"right":this.next()}}.bind(this)),this.element.addEvent("click:relay("+this.options.closeEvent+")",this.__hide).addEvent("click:relay("+this.options.nextEvent+")",this.next).addEvent("click:relay("+this.options.prevEvent+")",this.prev).addEvent("click:relay("+this.options.jumpEvent+")",this.__jump),this},hide:function(){return this.parent(function(){this.options.blackout&&this.blackout.hide(),this.element.removeClass("is-single"),this.items.removeProperty("style").getElements("li").removeClass("show")}.bind(this)),this},jump:function(a){a>=this.data.length?a=0:0>a&&(a=this.data.length-1);var b=this,c=this.options,d=this.element,e=this.items,f=e.getElements("li"),g=f[a],h=this.data,i=h[a];if(this.previousIndex=this.currentIndex,this.currentIndex=a,this.tabs){var j=this.tabs.getElements("a");j.removeClass("is-active"),j[a].addClass("is-active")}if(f.removeClass("show"),g.hasAttribute("data-width"))e.setStyles({width:g.get("data-width").toInt(),height:g.get("data-height").toInt()}),setTimeout(function(){g.addClass("show"),b._resize()},c.transition);else{d.addClass("is-loading");var k=new Image;k.src=i.image,k.onload=function(){e.setStyles({width:this.width,height:this.height}),g.set("data-width",this.width).set("data-height",this.height),i.title&&g.grab(new Element("div.showcase-caption").set("html",i.title)),setTimeout(function(){d.removeClass("is-loading"),g.addClass("show").grab(k),b._resize()},c.transition)}}return this.fireEvent("jump",a),this},next:function(){return this.jump(this.currentIndex+1),this},position:function(){return this.isVisible()||(this.options.blackout&&this.blackout.show(),this.element.reveal(),this._resize()),this.fireEvent("show"),this},prev:function(){return this.jump(this.currentIndex-1),this},show:function(a){this.node=a,this.currentIndex=this.previousIndex=0,this.element.addClass("is-loading");var b=this.options,c=this.readValue,d=c(a,b.getCategory),e=[],f=0;if(d)for(var g,h=0,i=0;g=this.nodes[h];h++)c(g,b.getCategory)===d&&(g===a&&(f=i),e.push({title:c(g,b.getTitle),category:d,image:c(g,b.getImage)}),i++);else e.push({title:c(a,b.getTitle),category:d,image:c(a,b.getImage)});return this.fireEvent("show"),this._buildItems(e),this.position(),this.jump(f),this},_buildItems:function(a){this.data=a,this.items.empty(),this.tabs.empty();for(var b,c,d,e=0;d=a[e];e++)b=new Element("li"),b.inject(this.items),c=new Element("a").set("class",this.options.jumpEvent.substr(1)).set("href","javascript:;").set("data-index",e),b=new Element("li"),b.inject(this.tabs).grab(c);return a.length<=1&&this.element.addClass("is-single"),this}.protect(),_resize:function(){if(Browser.ie8){var a=this.element.getSize();this.element.setStyles({"margin-left":-(a.x/2),"margin-top":-(a.y/2)})}},__jump:function(a){a.stop(),this.jump(a.target.get("data-index")||0)}}),Elements.implement("showcase",function(a){var b=new Titon.Showcase(this,a);return this.each(function(a){a.$showcase||(a.$showcase=b)})})}();
!function(){"use strict";Titon.Tabs=new Class({Extends:Titon.Component,nav:null,sections:[],tabs:[],previousIndex:0,currentIndex:0,options:{ajax:!0,collapsible:!1,defaultIndex:0,persistState:!1,preventDefault:!0,cookie:null,cookieDuration:30,navElement:".tabs-nav",sectionsElement:".tabs-section",template:!1},initialize:function(a,b){if(this.parent(b),this.setElement(a),this.element){this.options.cookie||(this.options.cookie=this.element.get("id")),this.nav=this.element.getElement(this.options.navElement),this.tabs=this.nav.getElements("ul > li > a"),this.tabs.each(function(a,b){a.set("data-index",b).removeClass("is-active")}),this.sections=this.element.getElements(this.options.sectionsElement),this.sections.conceal(),this.bindEvents(),this.fireEvent("init");var c=Number.from(Cookie.read("titon.tabs."+this.options.cookie)||this.options.defaultIndex);this.jump(c)}},bindEvents:function(){return this.tabs.addEvent("click"===this.options.mode?"click":"mouseover",this.__show),"hover"===this.options.mode&&this.options.preventDefault&&this.tabs.addEvent("click",function(a){a.preventDefault()}),this},hide:function(){return this.sections.conceal(),this.fireEvent("hide",this.node),this},jump:function(a){return this.tabs[a]&&this.show(this.tabs[a]),this},show:function(a){var b=a.get("data-index"),c=this.sections[b],d=a.get("href");return this.options.ajax&&d&&!d.contains("#")&&!this.cache[d]&&new Request({url:d,method:"get",evalScripts:!0,onSuccess:function(a){this.cache[d]=!0,c.set("html",a).removeClass("is-loading")}.bind(this),onRequest:function(){c.set("html",this._loadingTemplate()).addClass("is-loading")}.bind(this),onFailure:function(){c.set("html",this._errorTemplate()).removeClass("is-loading").addClass("has-failed")}.bind(this)}).get(),this.nav.getElements("ul > li").removeClass("is-active"),b===this.currentIndex&&this.options.collapsible?c.isVisible()?c.conceal():(a.getParent().addClass("is-active"),c.reveal()):(this.hide(),a.getParent().addClass("is-active"),c.reveal()),this.options.persistState&&Cookie.write("titon.tabs."+this.options.cookie,b,{duration:this.options.cookieDuration}),this.previousIndex=this.currentIndex,this.currentIndex=b,this.fireEvent("show",a),this.node=a,this},__show:function(a){this.options.preventDefault&&a.preventDefault(),this.enabled&&this.show(a.target)}}),Element.implement("tabs",function(a){return this.$tabs||(this.$tabs=new Titon.Tabs(this,a)),this})}();